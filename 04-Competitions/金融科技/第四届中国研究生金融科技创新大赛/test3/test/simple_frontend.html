<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºäºéšç§è®¡ç®—çš„æ™ºèƒ½åŒ–ESGè¯„ä»·ä¸ç¢³é‡‘èæœåŠ¡å¹³å°</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #2E7D32;
            --secondary-color: #1976D2;
            --success-color: #4CAF50;
            --warning-color: #FF9800;
            --danger-color: #F44336;
            --dark-color: #212121;
            --light-bg: #F8F9FA;
            --card-shadow: 0 4px 6px rgba(0,0,0,0.1);
            --hover-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
            color: var(--dark-color);
        }

        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 260px;
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .sidebar-header {
            padding: 2rem 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-brand {
            font-weight: 700;
            color: white !important;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .sidebar-brand i {
            font-size: 1.5rem;
            color: #4CAF50;
        }

        .sidebar-nav {
            padding: 1rem 0;
        }

        .sidebar-nav-item {
            display: block;
            color: rgba(255,255,255,0.8) !important;
            padding: 1rem 1.5rem;
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            font-weight: 500;
        }

        .sidebar-nav-item:hover {
            background: rgba(255,255,255,0.1);
            color: white !important;
            border-left-color: #4CAF50;
            text-decoration: none;
        }

        .sidebar-nav-item.active {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50 !important;
            border-left-color: #4CAF50;
            text-decoration: none;
        }

        .sidebar-nav-item i {
            margin-right: 0.75rem;
            width: 20px;
            text-align: center;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-wrapper {
            margin-left: 260px;
            min-height: 100vh;
            background: #f0f2f5;
            transition: margin-left 0.3s ease;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-wrapper {
                margin-left: 0;
            }

            .sidebar-toggle {
                display: block;
                position: fixed;
                top: 1rem;
                left: 1rem;
                z-index: 1001;
                background: var(--primary-color);
                color: white;
                border: none;
                border-radius: 0.5rem;
                padding: 0.75rem;
                font-size: 1.2rem;
                box-shadow: var(--card-shadow);
            }

            .main-container {
                margin: 1rem;
            }

            .page-content {
                padding: 1rem;
            }
        }

        @media (min-width: 769px) {
            .sidebar-toggle {
                display: none;
            }
        }

        /* ä¸»å®¹å™¨ */
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            margin: 2rem;
            border-radius: 1rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .page-content {
            padding: 2rem;
            animation: fadeIn 0.5s ease-in-out;
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* ä»ªè¡¨ç›˜ç‰¹æ®ŠèƒŒæ™¯ */
        #dashboard {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #667eea 100%);
            color: white;
            border-radius: 1rem;
        }

        #dashboard .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #dashboard .card-header {
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }

        #dashboard .text-muted {
            color: rgba(255, 255, 255, 0.8) !important;
        }

        #dashboard h2, #dashboard h3, #dashboard h4, #dashboard h5, #dashboard h6 {
            color: white;
        }

        /* å›¾è¡¨å®¹å™¨ç‰¹æ®Šæ ·å¼ */
        #dashboard .chart-container {
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        #dashboard canvas {
            background: white !important;
            border-radius: 0.25rem;
        }

        /* å›¾è¡¨å¡ç‰‡ç‰¹æ®Šæ ·å¼ */
        #dashboard .card:has(canvas) {
            background: white;
        }

        #dashboard .card:has(canvas) .card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        #dashboard .card:has(canvas) .card-body {
            background: white;
            padding: 1.5rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            border: none;
            border-radius: 1rem;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            overflow: hidden;
            background: white;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-weight: 600;
            border: none;
            padding: 1.5rem;
        }

        .card-body {
            padding: 2rem;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stat-card {
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }

        .stat-card .card-body {
            position: relative;
            z-index: 1;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0.5rem 0;
        }

        .stat-icon {
            font-size: 3rem;
            opacity: 0.3;
            position: absolute;
            right: 1rem;
            top: 1rem;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .table {
            border-radius: 0.5rem;
            overflow: hidden;
            width: 100%;
            table-layout: auto;
        }

        .table-responsive {
            max-height: none;
            overflow-x: auto;
            overflow-y: visible;
        }

        #companiesList {
            min-height: 600px;
            max-height: none;
        }

        #companiesList .table-responsive {
            min-height: 500px;
            max-height: none;
            height: auto !important;
        }

        #companiesList .table {
            height: auto !important;
            display: table !important;
        }

        #companiesList .table tbody {
            height: auto !important;
            display: table-row-group !important;
        }

        #companiesList .table tbody tr {
            display: table-row !important;
            height: auto !important;
            min-height: 60px;
        }

        /* ç¡®ä¿ä¼ä¸šç®¡ç†é¡µé¢çš„å¡ç‰‡å®¹å™¨ä¸é™åˆ¶é«˜åº¦ */
        #companies .card {
            height: auto !important;
            min-height: 600px;
            max-height: none;
        }

        #companies .card-body {
            height: auto !important;
            min-height: 800px;
            max-height: none;
            padding: 1.5rem;
            overflow: visible;
        }

        /* å¼ºåˆ¶æ˜¾ç¤ºæ‰€æœ‰è¡¨æ ¼è¡Œ */
        #companiesList .table {
            width: 100% !important;
            height: auto !important;
            display: table !important;
            table-layout: auto !important;
        }

        #companiesList .table tbody {
            display: table-row-group !important;
            height: auto !important;
        }

        #companiesList .table tbody tr {
            display: table-row !important;
            height: auto !important;
            min-height: 50px !important;
            max-height: none !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        #companiesList .table tbody td {
            display: table-cell !important;
            height: auto !important;
            min-height: 50px !important;
            padding: 12px 8px !important;
            vertical-align: middle !important;
            white-space: normal !important;
        }

        .table thead {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .table tbody tr:hover {
            background: rgba(46, 125, 50, 0.05);
            transform: scale(1.01);
            transition: all 0.2s ease;
        }

        .table tbody tr {
            min-height: 60px;
            vertical-align: middle;
        }

        .table tbody td {
            padding: 15px 10px;
            vertical-align: middle;
            line-height: 1.5;
            white-space: normal;
        }

        .table tbody td .badge {
            font-size: 0.85em;
            padding: 6px 10px;
        }

        /* å¾½ç« æ ·å¼ */
        .badge {
            padding: 0.5rem 1rem;
            font-weight: 500;
            border-radius: 0.5rem;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 125, 50, 0.3);
        }

        /* è¡¨å•æ ·å¼ */
        .form-control, .form-select {
            border-radius: 0.5rem;
            border: 2px solid #e0e0e0;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(46, 125, 50, 0.25);
        }

        /* è¿›åº¦æ¡æ ·å¼ */
        .progress {
            height: 1rem;
            border-radius: 0.5rem;
            background: #e0e0e0;
        }

        .progress-bar {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 0.5rem;
        }

        /* åˆ†é¡µæ ·å¼ */
        .pagination {
            justify-content: center;
            margin-top: 2rem;
        }

        .page-link {
            border-radius: 0.5rem;
            margin: 0 0.25rem;
            border: none;
            color: var(--primary-color);
        }

        .page-link:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .page-item.active .page-link {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            position: relative;
            height: 400px;
            margin: 2rem 0;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .main-container {
                margin: 1rem;
                border-radius: 0.5rem;
            }

            .page-content {
                padding: 1rem;
            }

            .stat-number {
                font-size: 2rem;
            }

            .card-body {
                padding: 1rem;
            }
        }

        /* å·¥å…·æç¤º */
        .tooltip-inner {
            background: var(--dark-color);
            border-radius: 0.5rem;
        }

        /* è­¦å‘Šæ¡† */
        .alert {
            border-radius: 0.5rem;
            border: none;
        }

        /* æœç´¢æ¡†æ ·å¼ */
        .search-box {
            position: relative;
        }

        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .search-box input {
            padding-left: 3rem;
        }

        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5rem;
            animation: pulse 2s infinite;
        }

        .status-online {
            background: var(--success-color);
        }

        .status-offline {
            background: var(--danger-color);
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }
    </style>
</head>
<body>
    <!-- ç§»åŠ¨ç«¯ä¾§è¾¹æ åˆ‡æ¢æŒ‰é’® -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <i class="bi bi-list"></i>
    </button>

    <!-- ä¾§è¾¹æ  -->
    <div class="sidebar">
        <div class="sidebar-header">
            <a href="#" class="sidebar-brand">
                <i class="bi bi-leaf-fill"></i>
                ESGè¯„ä»·ä¸ç¢³é‡‘èæœåŠ¡å¹³å°
            </a>
        </div>
        <div class="sidebar-nav">
            <a href="#" class="sidebar-nav-item active" onclick="showPage('dashboard')">
                <i class="bi bi-speedometer2"></i> ä»ªè¡¨ç›˜
            </a>
            <a href="#" class="sidebar-nav-item" onclick="showPage('companies')">
                <i class="bi bi-building"></i> ä¼ä¸šç®¡ç†
            </a>
            <a href="#" class="sidebar-nav-item" onclick="showPage('esg')">
                <i class="bi bi-graph-up"></i> ESGè¯„ä»·
            </a>
            <a href="#" class="sidebar-nav-item" onclick="showPage('carbon')">
                <i class="bi bi-tree"></i> ç¢³èµ„äº§
            </a>
            <a href="#" class="sidebar-nav-item" onclick="showPage('blockchain')">
                <i class="bi bi-link-45deg"></i> åŒºå—é“¾
            </a>
            <a href="#" class="sidebar-nav-item" onclick="showPage('monitoring')">
                <i class="bi bi-activity"></i> ç³»ç»Ÿç›‘æ§
            </a>
        </div>
    </div>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="main-wrapper">
        <!-- ä¸»å®¹å™¨ -->
        <div class="main-container">
        <!-- ä»ªè¡¨ç›˜é¡µé¢ -->
        <div id="dashboard" class="page-content active">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-speedometer2"></i> ç³»ç»Ÿæ¦‚è§ˆ</h2>
                <span class="status-indicator status-online"></span>
                <span class="text-muted">ç³»ç»Ÿè¿è¡Œä¸­</span>
            </div>

            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="row mb-4">
                <div class="col-md-3 mb-3">
                    <div class="card stat-card bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <div class="card-body text-white">
                            <i class="bi bi-building stat-icon"></i>
                            <h6 class="card-title">ä¼ä¸šæ€»æ•°</h6>
                            <div class="stat-number" id="totalCompanies">156</div>
                            <small>æ´»è·ƒä¼ä¸šå æ¯” 78%</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card bg-gradient" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <div class="card-body text-white">
                            <i class="bi bi-link-45deg stat-icon"></i>
                            <h6 class="card-title">åŒºå—é“¾äº¤æ˜“</h6>
                            <div class="stat-number" id="totalTransactions">1,000</div>
                            <small>ä»Šæ—¥æ–°å¢ 89 ç¬”</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card bg-gradient" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <div class="card-body text-white">
                            <i class="bi bi-tree stat-icon"></i>
                            <h6 class="card-title">ç¢³èµ„äº§é¡¹ç›®</h6>
                            <div class="stat-number" id="totalCarbonAssets">200</div>
                            <small>æ€»ä¼°å€¼ Â¥2.87äº¿</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card bg-gradient" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                        <div class="card-body text-white">
                            <i class="bi bi-graph-up stat-icon"></i>
                            <h6 class="card-title">ESGè¯„ä»·è®°å½•</h6>
                            <div class="stat-number" id="totalEsgRecords">2,000</div>
                            <small>å¹³å‡è¯„åˆ† 68.7</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å›¾è¡¨åŒºåŸŸ -->
            <div class="row">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header">
                            <i class="bi bi-bar-chart"></i> ESGè¯„åˆ†åˆ†å¸ƒ
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="esgChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <i class="bi bi-pie-chart"></i> è¡Œä¸šåˆ†å¸ƒ
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="industryChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¼ä¸šç®¡ç†é¡µé¢ -->
        <div id="companies" class="page-content">
            <div class="card">
                <div class="card-header" style="background: linear-gradient(135deg, #2e7d32, #43a047); color: white !important;">
                    <h4 class="mb-0" style="color: white !important;">ğŸ¢ ä¼ä¸šç®¡ç†</h4>
                </div>

                <div class="card-body">
                    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                    <div class="row mb-4 p-3" style="background: #f8f9fa; border-radius: 8px;">
                        <div class="col-md-3 text-center">
                            <h5 id="totalCompaniesCount" class="text-primary">156</h5>
                            <small class="text-muted">ä¸€å…±æœ‰156å®¶ä¼ä¸š</small>
                        </div>
                        <div class="col-md-3 text-center">
                            <h5 id="activeCompaniesCount" class="text-success">0</h5>
                            <small class="text-muted">æ´»è·ƒä¼ä¸š</small>
                        </div>
                        <div class="col-md-3 text-center">
                            <h5 id="avgESGScore" class="text-info">0</h5>
                            <small class="text-muted">å¹³å‡ESGè¯„åˆ†</small>
                        </div>
                        <div class="col-md-3 text-center">
                            <h5 id="displayedCompaniesCount" class="text-warning">0</h5>
                            <small class="text-muted">å½“å‰æ˜¾ç¤º</small>
                        </div>
                    </div>

                    <!-- æœç´¢å’Œç­›é€‰ -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <label class="form-label text-success fw-bold">ğŸ” ä¼ä¸šæœç´¢</label>
                            <div class="input-group">
                                <span class="input-group-text bg-success text-white">ğŸ”</span>
                                <input type="text" class="form-control border-success" id="companySearch" placeholder="è¾“å…¥ä¼ä¸šåç§°è¿›è¡Œæœç´¢..." onkeyup="searchCompanies()">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label text-primary fw-bold">ğŸ­ è¡Œä¸šç­›é€‰</label>
                            <select class="form-select border-primary" id="industryFilter" onchange="filterCompanies()">
                                <option value="">æ‰€æœ‰è¡Œä¸š</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label text-info fw-bold">ğŸ“„ åˆ†é¡µè®¾ç½®</label>
                            <select class="form-select border-info" id="pageSize" onchange="changePageSize()">
                                <option value="10" selected>æ¯é¡µ10æ¡</option>
                                <option value="20">æ¯é¡µ20æ¡</option>
                                <option value="50">æ¯é¡µ50æ¡</option>
                                <option value="100">æ¯é¡µ100æ¡</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label text-secondary fw-bold">ğŸ”„ æ“ä½œ</label>
                            <button class="btn btn-primary w-100 mt-2" onclick="loadCompanies()">
                                <i class="bi bi-arrow-clockwise"></i> åˆ·æ–°æ•°æ®
                            </button>
                        </div>
                    </div>

                    <!-- ä¼ä¸šåˆ—è¡¨ -->
                    <div id="companiesList" style="min-height: 500px;">
                        <div class="text-center p-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">åŠ è½½ä¸­...</span>
                            </div>
                            <p class="mt-3">æ­£åœ¨åŠ è½½ä¼ä¸šæ•°æ®...</p>
                        </div>
                    </div>

                    <!-- åˆ†é¡µå¯¼èˆª -->
                    <div class="d-flex justify-content-center mt-4">
                        <nav>
                            <ul class="pagination mb-0" id="companiesPagination">
                                <!-- åˆ†é¡µå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>

        <!-- ESGè¯„ä»·é¡µé¢ -->
        <div id="esg" class="page-content">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-graph-up"></i> ESGè¯„ä»·</h2>
                <button class="btn btn-primary" onclick="loadEsgHistory()">
                    <i class="bi bi-clock-history"></i> è¯„ä»·å†å²
                </button>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <i class="bi bi-clipboard-check"></i> ä¼ä¸šESGè¯„ä»·
                        </div>
                        <div class="card-body">
                            <form id="esgForm">
                                <div class="mb-3">
                                    <label class="form-label">ğŸ¢ ä¼ä¸šåç§°</label>
                                    <select class="form-select" id="companyId" required>
                                        <option value="">è¯·é€‰æ‹©ä¼ä¸š...</option>
                                    </select>
                                    <div class="form-text">é€‰æ‹©è¦è¿›è¡ŒESGè¯„ä»·çš„ä¼ä¸š</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">ç¯å¢ƒè¯„åˆ† (0-100)</label>
                                    <input type="range" class="form-range" id="environmentalScore" min="0" max="100" value="75" oninput="updateScoreDisplay('environmentalScore', this.value)">
                                    <div class="d-flex justify-content-between">
                                        <small class="text-muted">ç¯å¢ƒå› ç´ </small>
                                        <span class="badge bg-primary" id="environmentalScore-display">75</span>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">ç¤¾ä¼šè¯„åˆ† (0-100)</label>
                                    <input type="range" class="form-range" id="socialScore" min="0" max="100" value="68" oninput="updateScoreDisplay('socialScore', this.value)">
                                    <div class="d-flex justify-content-between">
                                        <small class="text-muted">ç¤¾ä¼šè´£ä»»</small>
                                        <span class="badge bg-info" id="socialScore-display">68</span>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">æ²»ç†è¯„åˆ† (0-100)</label>
                                    <input type="range" class="form-range" id="governanceScore" min="0" max="100" value="82" oninput="updateScoreDisplay('governanceScore', this.value)">
                                    <div class="d-flex justify-content-between">
                                        <small class="text-muted">å…¬å¸æ²»ç†</small>
                                        <span class="badge bg-success" id="governanceScore-display">82</span>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="bi bi-calculator"></i> æäº¤è¯„ä»·
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div id="esgResult">
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-award"></i> è¯„ä»·ç»“æœ
                            </div>
                            <div class="card-body text-center">
                                <i class="bi bi-clipboard-data" style="font-size: 3rem; color: #ccc;"></i>
                                <p class="text-muted mt-3">æäº¤è¡¨å•åæŸ¥çœ‹è¯„ä»·ç»“æœ</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ESGå†å²è®°å½• -->
            <div class="card mt-4" id="esgHistoryCard" style="display: none;">
                <div class="card-header">
                    <i class="bi bi-clock-history"></i> ESGè¯„ä»·å†å²
                </div>
                <div class="card-body">
                    <div id="esgHistoryList"></div>
                </div>
            </div>
        </div>

        <!-- ç¢³èµ„äº§é¡µé¢ -->
        <div id="carbon" class="page-content">
            <!-- é¡µé¢æ ‡é¢˜å’Œè¯´æ˜ -->
            <div class="card mb-4 border-0 bg-gradient bg-success">
                <div class="card-body text-white py-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h2 class="mb-2"><i class="bi bi-tree"></i> ç¢³èµ„äº§ç®¡ç†</h2>
                            <p class="mb-0 opacity-90">è¯„ä¼°å’Œç®¡ç†æ‚¨çš„ç¢³å‡æ’é¡¹ç›®ï¼Œè®¡ç®—ç¢³èµ„äº§ä»·å€¼ï¼ŒåŠ©åŠ›ç¢³ä¸­å’Œç›®æ ‡å®ç°</p>
                        </div>
                        <div>
                            <button class="btn btn-warning me-2" onclick="showAddCarbonAssetModal()">
                                <i class="bi bi-plus-circle"></i> æ·»åŠ é¡¹ç›®
                            </button>
                            <button class="btn btn-light" onclick="loadCarbonAssets()">
                                <i class="bi bi-arrow-clockwise"></i> åˆ·æ–°æ•°æ®
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ¦‚è§ˆç»Ÿè®¡å¡ç‰‡ -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card border-0 bg-light">
                        <div class="card-body text-center">
                            <i class="bi bi-graph-up-arrow text-success" style="font-size: 2rem;"></i>
                            <h4 class="mt-2" id="totalProjects">0</h4>
                            <p class="text-muted mb-0">æ€»é¡¹ç›®æ•°</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 bg-light">
                        <div class="card-body text-center">
                            <i class="bi bi-cloud text-primary" style="font-size: 2rem;"></i>
                            <h4 class="mt-2" id="totalCarbon">0</h4>
                            <p class="text-muted mb-0">æ€»ç¢³æ±‡é‡(å¨)</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 bg-light">
                        <div class="card-body text-center">
                            <i class="bi bi-currency-dollar text-warning" style="font-size: 2rem;"></i>
                            <h4 class="mt-2" id="totalValue">Â¥0</h4>
                            <p class="text-muted mb-0">æ€»ä¼°å€¼</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 bg-light">
                        <div class="card-body text-center">
                            <i class="bi bi-globe text-info" style="font-size: 2rem;"></i>
                            <h4 class="mt-2" id="avgPrice">Â¥0</h4>
                            <p class="text-muted mb-0">å¹³å‡å•ä»·</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-primary text-white">
                            <i class="bi bi-calculator"></i> ç¢³èµ„äº§ä¼°å€¼è®¡ç®—å™¨
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info mb-3">
                                <i class="bi bi-info-circle"></i>
                                <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong>å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼Œç³»ç»Ÿå°†æ ¹æ®å½“å‰å¸‚åœºä»·æ ¼ä¸ºæ‚¨è®¡ç®—ç¢³èµ„äº§ä»·å€¼
                            </div>
                            <form id="carbonForm">
                                <div class="mb-3">
                                    <label class="form-label fw-bold text-primary">ğŸŒ± é¡¹ç›®ç±»å‹</label>
                                    <select class="form-select border-primary" id="projectType" required>
                                        <option value="">è¯·é€‰æ‹©é¡¹ç›®ç±»å‹...</option>
                                        <option value="æ—ä¸šç¢³æ±‡">ğŸŒ³ æ—ä¸šç¢³æ±‡ - æ£®æ—å¸æ”¶äºŒæ°§åŒ–ç¢³</option>
                                        <option value="å¯å†ç”Ÿèƒ½æº">âš¡ å¯å†ç”Ÿèƒ½æº - é£èƒ½ã€å¤ªé˜³èƒ½ç­‰</option>
                                        <option value="èŠ‚èƒ½æ”¹é€ ">ğŸ’¡ èŠ‚èƒ½æ”¹é€  - æé«˜èƒ½æºæ•ˆç‡</option>
                                        <option value="ç”²çƒ·å›æ”¶">ğŸ”¥ ç”²çƒ·å›æ”¶ - å‡å°‘æ¸©å®¤æ°”ä½“æ’æ”¾</option>
                                        <option value="ç”Ÿç‰©è´¨èƒ½æº">ğŸŒ¾ ç”Ÿç‰©è´¨èƒ½æº - æœ‰æœºç‰©è½¬åŒ–èƒ½æº</option>
                                    </select>
                                    <div class="form-text">é€‰æ‹©æ‚¨çš„ç¢³å‡æ’é¡¹ç›®ç±»å‹</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-bold text-primary">â˜ï¸ ç¢³æ±‡é‡ (å¨COâ‚‚)</label>
                                    <input type="number" class="form-control border-primary" id="carbonAmount" min="1" step="0.01" placeholder="è¯·è¾“å…¥ç¢³æ±‡é‡" required>
                                    <div class="form-text">é¡¹ç›®å‡å°‘æˆ–å¸æ”¶çš„äºŒæ°§åŒ–ç¢³æ€»é‡</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-bold text-primary">ğŸ“ é¡¹ç›®åœ°ç‚¹</label>
                                    <select class="form-select border-primary" id="projectLocation" required>
                                        <option value="">è¯·é€‰æ‹©é¡¹ç›®åœ°ç‚¹...</option>
                                        <option value="åŒ—äº¬å¸‚">ğŸ›ï¸ åŒ—äº¬å¸‚</option>
                                        <option value="ä¸Šæµ·å¸‚">ğŸ™ï¸ ä¸Šæµ·å¸‚</option>
                                        <option value="å¹¿å·å¸‚">ğŸŒ´ å¹¿å·å¸‚</option>
                                        <option value="æ·±åœ³å¸‚">ğŸ¢ æ·±åœ³å¸‚</option>
                                        <option value="æ­å·å¸‚">ğŸï¸ æ­å·å¸‚</option>
                                        <option value="æˆéƒ½å¸‚">ğŸ¼ æˆéƒ½å¸‚</option>
                                        <option value="æ­¦æ±‰å¸‚">ğŸŒŠ æ­¦æ±‰å¸‚</option>
                                        <option value="è¥¿å®‰å¸‚">ğŸ® è¥¿å®‰å¸‚</option>
                                        <option value="å—äº¬å¸‚">ğŸŒ¸ å—äº¬å¸‚</option>
                                    </select>
                                    <div class="form-text">é¡¹ç›®å®æ–½çš„å…·ä½“åœ°ç†ä½ç½®</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-bold text-primary">ğŸ“… é¡¹ç›®å¹´ä»½</label>
                                    <input type="number" class="form-control border-primary" id="projectYear" min="2020" max="2024" value="2024" placeholder="2024" required>
                                    <div class="form-text">é¡¹ç›®å®æ–½çš„å¹´ä»½ï¼ˆå½±å“ä»·æ ¼è®¡ç®—ï¼‰</div>
                                </div>
                                <button type="submit" class="btn btn-primary w-100 btn-lg">
                                    <i class="bi bi-currency-dollar"></i> å¼€å§‹è®¡ç®—ä¼°å€¼
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div id="carbonResult">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-success text-white">
                                <i class="bi bi-graph-up-arrow"></i> ç¢³èµ„äº§ä¼°å€¼ç»“æœ
                            </div>
                            <div class="card-body">
                                <div class="text-center py-5">
                                    <i class="bi bi-cash-stack text-muted" style="font-size: 4rem;"></i>
                                    <h5 class="text-muted mt-3 mb-4">ç­‰å¾…ä¼°å€¼è®¡ç®—...</h5>
                                    <div class="alert alert-light">
                                        <i class="bi bi-lightbulb text-warning"></i>
                                        <strong>æç¤ºï¼š</strong>è¯·å…ˆåœ¨å·¦ä¾§å¡«å†™é¡¹ç›®ä¿¡æ¯å¹¶ç‚¹å‡»"å¼€å§‹è®¡ç®—ä¼°å€¼"
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç¢³èµ„äº§é¡¹ç›®åˆ—è¡¨ -->
            <div class="card mt-4 border-0 shadow-sm">
                <div class="card-header bg-info text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <i class="bi bi-list-ul"></i>
                            <strong>ç¢³èµ„äº§é¡¹ç›®åˆ—è¡¨</strong>
                            <small class="ms-2 opacity-75">æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰ç¢³èµ„äº§é¡¹ç›®</small>
                        </div>
                        <div>
                            <span class="badge bg-light text-dark" id="projectCount">0 ä¸ªé¡¹ç›®</span>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <!-- ç­›é€‰å™¨ -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="input-group">
                                <span class="input-group-text bg-light">ğŸ”</span>
                                <input type="text" class="form-control" id="carbonSearch" placeholder="æœç´¢é¡¹ç›®..." onkeyup="searchCarbonAssets()">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="carbonTypeFilter" onchange="filterCarbonAssets()">
                                <option value="">æ‰€æœ‰ç±»å‹</option>
                                <option value="æ—ä¸šç¢³æ±‡">æ—ä¸šç¢³æ±‡</option>
                                <option value="å¯å†ç”Ÿèƒ½æº">å¯å†ç”Ÿèƒ½æº</option>
                                <option value="èŠ‚èƒ½æ”¹é€ ">èŠ‚èƒ½æ”¹é€ </option>
                                <option value="ç”²çƒ·å›æ”¶">ç”²çƒ·å›æ”¶</option>
                                <option value="ç”Ÿç‰©è´¨èƒ½æº">ç”Ÿç‰©è´¨èƒ½æº</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="carbonLocationFilter" onchange="filterCarbonAssets()">
                                <option value="">æ‰€æœ‰åœ°ç‚¹</option>
                                <option value="åŒ—äº¬å¸‚">åŒ—äº¬å¸‚</option>
                                <option value="ä¸Šæµ·å¸‚">ä¸Šæµ·å¸‚</option>
                                <option value="å¹¿å·å¸‚">å¹¿å·å¸‚</option>
                                <option value="æ·±åœ³å¸‚">æ·±åœ³å¸‚</option>
                                <option value="æ­å·å¸‚">æ­å·å¸‚</option>
                                <option value="æˆéƒ½å¸‚">æˆéƒ½å¸‚</option>
                                <option value="æ­¦æ±‰å¸‚">æ­¦æ±‰å¸‚</option>
                                <option value="è¥¿å®‰å¸‚">è¥¿å®‰å¸‚</option>
                                <option value="å—äº¬å¸‚">å—äº¬å¸‚</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-outline-primary w-100" onclick="loadCarbonAssets()">
                                <i class="bi bi-arrow-clockwise"></i> åˆ·æ–°
                            </button>
                        </div>
                    </div>

                    <!-- æ•°æ®è¡¨æ ¼ -->
                    <div id="carbonAssetsList" class="table-responsive">
                        <div class="text-center py-5">
                            <div class="spinner-border text-primary mb-3" role="status">
                                <span class="visually-hidden">åŠ è½½ä¸­...</span>
                            </div>
                            <p class="text-muted">æ­£åœ¨åŠ è½½ç¢³èµ„äº§é¡¹ç›®æ•°æ®...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åŒºå—é“¾é¡µé¢ -->
        <div id="blockchain" class="page-content">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-link-45deg"></i> åŒºå—é“¾äº¤æ˜“ç›‘æ§å¹³å°</h2>
                <div>
                    <button class="btn btn-success" onclick="startRealTimeBlockchain()">
                        <i class="bi bi-play-circle"></i> å®æ—¶ç›‘æ§
                    </button>
                    <button class="btn btn-primary" onclick="loadBlockchainTransactions()">
                        <i class="bi bi-arrow-clockwise"></i> åˆ·æ–°æ•°æ®
                    </button>
                </div>
            </div>

            <!-- ç»Ÿè®¡æ¦‚è§ˆå¡ç‰‡ -->
            <div class="row mb-4">
                <div class="col-md-3 mb-3">
                    <div class="card stat-card bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <div class="card-body text-dark" style="background: rgba(255,255,255,0.9); border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                            <i class="bi bi-link-45deg stat-icon" style="color: #2c3e50 !important; font-size: 1.5rem;"></i>
                            <h6 class="card-title" style="color: #2c3e50 !important; font-weight: 700;">æ€»äº¤æ˜“æ•°</h6>
                            <div class="stat-number" id="totalTxCount" style="color: #1a252f !important; font-weight: 900; font-size: 2.2rem;">1,000</div>
                            <small style="color: #495057 !important; font-weight: 600;">å†å²ç´¯è®¡äº¤æ˜“ <span id="txGrowth" style="color: #28a745 !important; font-weight: 700;">+127</span></small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card bg-gradient" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <div class="card-body text-dark" style="background: rgba(255,255,255,0.9); border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                            <i class="bi bi-check-circle stat-icon" style="color: #2c3e50 !important; font-size: 1.5rem;"></i>
                            <h6 class="card-title" style="color: #2c3e50 !important; font-weight: 700;">å·²ç¡®è®¤</h6>
                            <div class="stat-number" id="confirmedTx" style="color: #1a252f !important; font-weight: 900; font-size: 2.2rem;">987</div>
                            <small style="color: #495057 !important; font-weight: 600;">ç¡®è®¤ç‡ <span id="confirmRate" style="color: #28a745 !important; font-weight: 700;">98.7%</span></small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card bg-gradient" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <div class="card-body text-dark" style="background: rgba(255,255,255,0.9); border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                            <i class="bi bi-hourglass-split stat-icon" style="color: #2c3e50 !important; font-size: 1.5rem;"></i>
                            <h6 class="card-title" style="color: #2c3e50 !important; font-weight: 700;">å¤„ç†ä¸­</h6>
                            <div class="stat-number" id="pendingTx" style="color: #1a252f !important; font-weight: 900; font-size: 2.2rem;">13</div>
                            <small style="color: #495057 !important; font-weight: 600;">å¹³å‡ç­‰å¾… <span id="avgWaitTime" style="color: #ffc107 !important; font-weight: 700;">2.3s</span></small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card stat-card bg-gradient" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                        <div class="card-body text-dark" style="background: rgba(255,255,255,0.9); border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                            <i class="bi bi-cpu stat-icon" style="color: #2c3e50 !important; font-size: 1.5rem;"></i>
                            <h6 class="card-title" style="color: #2c3e50 !important; font-weight: 700;">Gasè´¹ç”¨</h6>
                            <div class="stat-number" id="avgGas" style="color: #1a252f !important; font-weight: 900; font-size: 2.2rem;">0.0032</div>
                            <small style="color: #495057 !important; font-weight: 600;">ETH å¹³å‡è´¹ç”¨</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- äº¤æ˜“ç±»å‹åˆ†å¸ƒå›¾è¡¨ -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <i class="bi bi-pie-chart"></i> äº¤æ˜“ç±»å‹åˆ†å¸ƒ
                        </div>
                        <div class="card-body">
                            <canvas id="txTypeChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <i class="bi bi-graph-up"></i> 24å°æ—¶äº¤æ˜“è¶‹åŠ¿
                        </div>
                        <div class="card-body">
                            <canvas id="txVolumeChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- äº¤æ˜“è®°å½•è¡¨æ ¼ -->
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div>
                        <i class="bi bi-list"></i>
                        <span>äº¤æ˜“è®°å½•</span>
                        <span class="badge bg-primary ms-2" id="txCount">0</span>
                    </div>
                    <div class="d-flex gap-2">
                        <!-- æœç´¢æ¡† -->
                        <div class="input-group" style="width: 300px;">
                            <input type="text" class="form-control form-control-sm" placeholder="æœç´¢äº¤æ˜“å“ˆå¸Œæˆ–åœ°å€..." id="blockchainSearch">
                            <button class="btn btn-outline-secondary btn-sm" onclick="searchBlockchain()">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                        <!-- è¿‡æ»¤å™¨ -->
                        <select class="form-select form-select-sm" style="width: 150px;" id="txTypeFilter">
                            <option value="">å…¨éƒ¨ç±»å‹</option>
                            <option value="ESGè¯„ä»·è®°å½•">ESGè¯„ä»·è®°å½•</option>
                            <option value="ç¢³èµ„äº§äº¤æ˜“">ç¢³èµ„äº§äº¤æ˜“</option>
                            <option value="ä¼ä¸šä¿¡æ¯æ›´æ–°">ä¼ä¸šä¿¡æ¯æ›´æ–°</option>
                            <option value="æ•°æ®éªŒè¯">æ•°æ®éªŒè¯</option>
                            <option value="æ™ºèƒ½åˆçº¦æ‰§è¡Œ">æ™ºèƒ½åˆçº¦æ‰§è¡Œ</option>
                            <option value="ç¢³ä¿¡ç”¨å‘è¡Œ">ç¢³ä¿¡ç”¨å‘è¡Œ</option>
                            <option value="èµ„äº§æŠµæŠ¼">èµ„äº§æŠµæŠ¼</option>
                            <option value="æ•°æ®å…±äº«æˆæƒ">æ•°æ®å…±äº«æˆæƒ</option>
                            <option value="å®¡è®¡è®°å½•">å®¡è®¡è®°å½•</option>
                            <option value="åˆè§„æ£€æŸ¥">åˆè§„æ£€æŸ¥</option>
                        </select>
                        <select class="form-select form-select-sm" style="width: 120px;" id="txStatusFilter">
                            <option value="">å…¨éƒ¨çŠ¶æ€</option>
                            <option value="confirmed">å·²ç¡®è®¤</option>
                            <option value="pending">å¤„ç†ä¸­</option>
                        </select>
                    </div>
                </div>
                <div class="card-body">
                    <!-- åˆ†é¡µæ§åˆ¶ -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="btn-group" role="group">
                            <button class="btn btn-outline-primary btn-sm" onclick="loadBlockchainPage(1)">
                                <i class="bi bi-chevron-double-left"></i> é¦–é¡µ
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="loadBlockchainPreviousPage()">
                                <i class="bi bi-chevron-left"></i> ä¸Šä¸€é¡µ
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="loadBlockchainNextPage()">
                                ä¸‹ä¸€é¡µ <i class="bi bi-chevron-right"></i>
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="loadBlockchainPage(Math.ceil(blockchainTotalCount / blockchainPageSize))">
                                æœ«é¡µ <i class="bi bi-chevron-double-right"></i>
                            </button>
                        </div>
                        <div class="text-muted">
                            æ˜¾ç¤ºç¬¬ <span id="blockchainStart">1</span>-<span id="blockchainEnd">20</span> æ¡ï¼Œ
                            å…± <span id="blockchainTotal">0</span> æ¡è®°å½•
                        </div>
                        <select class="form-select form-select-sm" style="width: 100px;" id="blockchainPageSize" onchange="changeBlockchainPageSize()">
                            <option value="20">20æ¡/é¡µ</option>
                            <option value="50">50æ¡/é¡µ</option>
                            <option value="100">100æ¡/é¡µ</option>
                        </select>
                    </div>

                    <!-- äº¤æ˜“åˆ—è¡¨ -->
                    <div id="blockchainList" class="table-responsive">
                        <div class="text-center py-5">
                            <div class="spinner-border text-primary mb-3" role="status">
                                <span class="visually-hidden">åŠ è½½ä¸­...</span>
                            </div>
                            <p class="text-muted">æ­£åœ¨åŠ è½½åŒºå—é“¾äº¤æ˜“æ•°æ®...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- äº¤æ˜“è¯¦æƒ…æ¨¡æ€æ¡† -->
            <div class="modal fade" id="blockchainModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">äº¤æ˜“è¯¦æƒ…</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body" id="blockchainModalBody">
                            <!-- äº¤æ˜“è¯¦æƒ…å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                            <button type="button" class="btn btn-primary" onclick="copyTransactionHash()">
                                <i class="bi bi-clipboard"></i> å¤åˆ¶å“ˆå¸Œ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç³»ç»Ÿç›‘æ§é¡µé¢ -->
        <div id="monitoring" class="page-content">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-activity"></i> ç³»ç»Ÿç›‘æ§</h2>
                <div class="d-flex gap-2">
                    <span class="status-indicator status-online"></span>
                    <span class="text-muted">å®æ—¶ç›‘æ§ä¸­</span>
                </div>
            </div>

            <!-- ç³»ç»Ÿèµ„æºç›‘æ§ -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <i class="bi bi-cpu" style="font-size: 2rem; color: var(--primary-color);"></i>
                            <h5 class="mt-3">CPUä½¿ç”¨ç‡</h5>
                            <div class="progress mt-3">
                                <div class="progress-bar" id="cpuProgress" style="width: 45%"></div>
                            </div>
                            <h4 class="mt-2" id="cpuUsage">45%</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <i class="bi bi-memory" style="font-size: 2rem; color: var(--secondary-color);"></i>
                            <h5 class="mt-3">å†…å­˜ä½¿ç”¨ç‡</h5>
                            <div class="progress mt-3">
                                <div class="progress-bar bg-info" id="memoryProgress" style="width: 67%"></div>
                            </div>
                            <h4 class="mt-2" id="memoryUsage">67%</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <i class="bi bi-hdd" style="font-size: 2rem; color: var(--warning-color);"></i>
                            <h5 class="mt-3">ç£ç›˜ä½¿ç”¨ç‡</h5>
                            <div class="progress mt-3">
                                <div class="progress-bar bg-warning" id="diskProgress" style="width: 52%"></div>
                            </div>
                            <h4 class="mt-2" id="diskUsage">52%</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <i class="bi bi-wifi" style="font-size: 2rem; color: var(--success-color);"></i>
                            <h5 class="mt-3">ç½‘ç»œå»¶è¿Ÿ</h5>
                            <div class="progress mt-3">
                                <div class="progress-bar bg-success" id="networkProgress" style="width: 23%"></div>
                            </div>
                            <h4 class="mt-2" id="networkLatency">23ms</h4>
                        </div>
                    </div>
                </div>
            </div>

            <!-- APIæ€§èƒ½ç›‘æ§ -->
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-graph-up"></i> APIæ€§èƒ½ç›‘æ§
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>APIè°ƒç”¨ç»Ÿè®¡</h6>
                            <div class="row">
                                <div class="col-6">
                                    <small class="text-muted">æ€»è°ƒç”¨æ¬¡æ•°</small>
                                    <h4 id="apiCalls">2,468</h4>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">å¹³å‡å“åº”æ—¶é—´</small>
                                    <h4 id="responseTime">0.23s</h4>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">é”™è¯¯ç‡</small>
                                    <h4 id="errorRate">0.8%</h4>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">95%å“åº”æ—¶é—´</small>
                                    <h4 id="p95ResponseTime">0.89s</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>å®æ—¶æ€§èƒ½å›¾è¡¨</h6>
                            <div class="chart-container" style="height: 200px;">
                                <canvas id="performanceChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç³»ç»Ÿæ—¥å¿— -->
            <div class="card mt-4">
                <div class="card-header">
                    <i class="bi bi-journal-text"></i> ç³»ç»Ÿæ—¥å¿—
                </div>
                <div class="card-body">
                    <div id="systemLogs">
                        <div class="alert alert-success">
                            <i class="bi bi-check-circle"></i> ç³»ç»Ÿå¯åŠ¨æˆåŠŸ - 2025-10-05 00:30:15
                        </div>
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> æ•°æ®åº“è¿æ¥å·²å»ºç«‹ - 2025-10-05 00:30:16
                        </div>
                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle"></i> APIå“åº”æ—¶é—´ç•¥æœ‰å»¶è¿Ÿ - 2025-10-05 00:45:23
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
        </div> <!-- å…³é—­ main-container -->
    </div> <!-- å…³é—­ main-wrapper -->

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // å…¨å±€é…ç½®
        const API_BASE = 'http://localhost:8018';
        let currentPage = 'dashboard';
        let esgChart = null;
        let industryChart = null;
        let performanceChart = null;
        let txTypeChart = null;
        let txVolumeChart = null;

        // åŒºå—é“¾ç›¸å…³å˜é‡
        let blockchainCurrentPage = 1;
        let blockchainPageSize = 20;
        let blockchainTotalCount = 0;
        let allBlockchainTransactions = [];
        let filteredBlockchainTransactions = [];
        let blockchainRealTimeInterval = null;
        let currentTransactionDetail = null;

        // ä¼ä¸šåˆ†é¡µç›¸å…³å˜é‡
        let allCompanies = [];
        let companyCurrentPage = 1;
        let companiesPerPage = 100;

        // ä¾§è¾¹æ åˆ‡æ¢åŠŸèƒ½
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('show');
        }

        // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­ä¾§è¾¹æ ï¼ˆç§»åŠ¨ç«¯ï¼‰
        document.addEventListener('click', function(event) {
            const sidebar = document.querySelector('.sidebar');
            const toggle = document.querySelector('.sidebar-toggle');

            if (window.innerWidth <= 768 &&
                !sidebar.contains(event.target) &&
                !toggle.contains(event.target) &&
                sidebar.classList.contains('show')) {
                sidebar.classList.remove('show');
            }
        });

        // é¡µé¢åˆ‡æ¢åŠŸèƒ½
        function showPage(pageId) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });

            // æ˜¾ç¤ºç›®æ ‡é¡µé¢
            document.getElementById(pageId).classList.add('active');

            // æ›´æ–°å¯¼èˆªæ çŠ¶æ€
            document.querySelectorAll('.sidebar-nav-item').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');

            // ç§»åŠ¨ç«¯è‡ªåŠ¨å…³é—­ä¾§è¾¹æ 
            if (window.innerWidth <= 768) {
                const sidebar = document.querySelector('.sidebar');
                sidebar.classList.remove('show');
            }

            currentPage = pageId;

            // æ ¹æ®é¡µé¢åŠ è½½ç›¸åº”æ•°æ®
            switch(pageId) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'companies':
                    loadCompanies();
                    break;
                case 'esg':
                    // ESGé¡µé¢ä¸éœ€è¦è‡ªåŠ¨åŠ è½½æ•°æ®
                    break;
                case 'carbon':
                    loadCarbonAssets();
                    break;
                case 'blockchain':
                    loadBlockchainTransactions();
                    break;
                case 'monitoring':
                    loadMonitorData();
                    startMonitoring();
                    break;
            }
        }

        // åŠ è½½ä»ªè¡¨ç›˜æ•°æ®
        async function loadDashboardData() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();

                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                document.getElementById('totalCompanies').textContent = data.data_scale?.companies || 500;
                document.getElementById('totalTransactions').textContent = data.data_scale?.blockchain_txs || 1000;
                document.getElementById('totalCarbonAssets').textContent = data.data_scale?.carbon_assets || 200;
                document.getElementById('totalEsgRecords').textContent = data.data_scale?.esg_history || 2000;

                // åˆå§‹åŒ–å›¾è¡¨
                initCharts();
            } catch (error) {
                console.error('åŠ è½½ä»ªè¡¨ç›˜æ•°æ®å¤±è´¥:', error);
            }
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            // ESGè¯„åˆ†åˆ†å¸ƒå›¾
            const esgCtx = document.getElementById('esgChart').getContext('2d');
            if (esgChart) esgChart.destroy();
            esgChart = new Chart(esgCtx, {
                type: 'bar',
                data: {
                    labels: ['A+', 'A', 'B+', 'B', 'C+', 'C'],
                    datasets: [{
                        label: 'ä¼ä¸šæ•°é‡',
                        data: [18, 42, 53, 28, 12, 3],
                        backgroundColor: [
                            'rgba(76, 175, 80, 0.8)',
                            'rgba(33, 150, 243, 0.8)',
                            'rgba(255, 193, 7, 0.8)',
                            'rgba(255, 152, 0, 0.8)',
                            'rgba(244, 67, 54, 0.8)',
                            'rgba(156, 39, 176, 0.8)'
                        ],
                        borderWidth: 0,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#666'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#666'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: '#666'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff'
                        }
                    }
                }
            });

            // è¡Œä¸šåˆ†å¸ƒå›¾
            const industryCtx = document.getElementById('industryChart').getContext('2d');
            if (industryChart) industryChart.destroy();
            industryChart = new Chart(industryCtx, {
                type: 'doughnut',
                data: {
                    labels: ['åˆ¶é€ ä¸š', 'é‡‘èä¸š', 'æ–°èƒ½æº', 'ç¯ä¿æŠ€æœ¯', 'å†œä¸šç§‘æŠ€', 'å…¶ä»–'],
                    datasets: [{
                        data: [156, 98, 87, 76, 54, 29],
                        backgroundColor: [
                            'rgba(33, 150, 243, 0.8)',
                            'rgba(76, 175, 80, 0.8)',
                            'rgba(255, 193, 7, 0.8)',
                            'rgba(255, 152, 0, 0.8)',
                            'rgba(156, 39, 176, 0.8)',
                            'rgba(96, 125, 139, 0.8)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // åŠ è½½ä¼ä¸šæ•°æ®
        // ä¼ä¸šç®¡ç† - ç®€å•ç‰ˆæœ¬JavaScriptå‡½æ•°
        let allCompaniesData = [];
        let filteredCompaniesData = [];
        let companiesCurrentPage = 1;
        let companiesPageSize = 10;

        // ç¢³èµ„äº§ç›¸å…³å…¨å±€å˜é‡
        let allCarbonAssets = [];
        let filteredCarbonAssets = [];
        let carbonAssetIdToDelete = null;
        let nextCarbonAssetId = 9; // ä»9å¼€å§‹ï¼Œå› ä¸ºç°æœ‰æ•°æ®åˆ°8

        async function loadCompanies() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/companies?page_size=156`);
                const data = await response.json();

                if (data.success && data.data) {
                    allCompaniesData = data.data;
                    filteredCompaniesData = allCompaniesData;

                    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                    updateCompaniesStats();

                    // å¡«å……è¡Œä¸šç­›é€‰å™¨
                    const industries = [...new Set(allCompaniesData.map(c => c.industry))];
                    const industryFilter = document.getElementById('industryFilter');
                    industryFilter.innerHTML = '<option value="">æ‰€æœ‰è¡Œä¸š</option>';
                    industries.forEach(industry => {
                        industryFilter.innerHTML += `<option value="${industry}">${industry}</option>`;
                    });

                    // æ˜¾ç¤ºä¼ä¸šæ•°æ®
                    displayCompaniesData();
                } else {
                    document.getElementById('companiesList').innerHTML =
                        '<div class="text-center p-5"><div class="alert alert-danger">âŒ åŠ è½½æ•°æ®å¤±è´¥</div></div>';
                }
            } catch (error) {
                console.error('é”™è¯¯:', error);
                document.getElementById('companiesList').innerHTML =
                    '<div class="text-center p-5"><div class="alert alert-danger">âŒ ç½‘ç»œé”™è¯¯</div></div>';
            }
        }

        function updateCompaniesStats() {
            const activeCount = filteredCompaniesData.filter(c => c.is_active).length;
            const avgESG = (filteredCompaniesData.reduce((sum, c) => sum + (c.esg_score || 0), 0) / filteredCompaniesData.length).toFixed(1);

            document.getElementById('totalCompaniesCount').textContent = allCompaniesData.length;
            document.getElementById('activeCompaniesCount').textContent = activeCount;
            document.getElementById('avgESGScore').textContent = avgESG;
            document.getElementById('displayedCompaniesCount').textContent = filteredCompaniesData.length;
        }

        function displayCompaniesData() {
            const companiesDiv = document.getElementById('companiesList');
            const start = (companiesCurrentPage - 1) * companiesPageSize;
            const end = start + companiesPageSize;
            const pageCompanies = filteredCompaniesData.slice(start, end);

            let html = `
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ä¼ä¸šåç§°</th>
                                <th>è¡Œä¸š</th>
                                <th>åœ°åŒº</th>
                                <th>å‘˜å·¥æ•°</th>
                                <th>æ³¨å†Œèµ„æœ¬</th>
                                <th>ESGè¯„åˆ†</th>
                                <th>çŠ¶æ€</th>
                                <th>æˆç«‹æ—¥æœŸ</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            pageCompanies.forEach(company => {
                const esgScore = company.esg_score || 0;
                const scoreClass = esgScore >= 80 ? 'success' : esgScore >= 70 ? 'warning' : 'danger';

                html += `
                    <tr>
                        <td><span class="badge bg-secondary">${company.id}</span></td>
                        <td><strong>${company.name}</strong></td>
                        <td><span class="badge bg-info">${company.industry}</span></td>
                        <td>${company.location}</td>
                        <td>${company.employees.toLocaleString()}</td>
                        <td>Â¥${(company.registered_capital/10000).toFixed(0)}ä¸‡</td>
                        <td><span class="badge bg-${scoreClass}">${esgScore}</span></td>
                        <td><span class="badge ${company.is_active ? 'bg-success' : 'bg-secondary'}">${company.is_active ? 'æ´»è·ƒ' : 'æœªæ¿€æ´»'}</span></td>
                        <td>${company.established_date}</td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                </div>
            `;

            companiesDiv.innerHTML = html;
            displayCompaniesPagination();
        }

        function displayCompaniesPagination() {
            const totalPages = Math.ceil(filteredCompaniesData.length / companiesPageSize);
            const pagination = document.getElementById('companiesPagination');
            pagination.innerHTML = '';

            // ä¸Šä¸€é¡µ
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${companiesCurrentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" onclick="changeCompaniesPage(${companiesCurrentPage - 1})">ä¸Šä¸€é¡µ</a>`;
            pagination.appendChild(prevLi);

            // é¡µç 
            for (let i = 1; i <= Math.min(totalPages, 10); i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === companiesCurrentPage ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" onclick="changeCompaniesPage(${i})">${i}</a>`;
                pagination.appendChild(li);
            }

            // ä¸‹ä¸€é¡µ
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${companiesCurrentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" onclick="changeCompaniesPage(${companiesCurrentPage + 1})">ä¸‹ä¸€é¡µ</a>`;
            pagination.appendChild(nextLi);

            // æ˜¾ç¤ºå½“å‰é¡µä¿¡æ¯
            const start = (companiesCurrentPage - 1) * companiesPageSize + 1;
            const end = Math.min(companiesCurrentPage * companiesPageSize, filteredCompaniesData.length);

            const infoLi = document.createElement('li');
            infoLi.className = 'page-item disabled';
            infoLi.innerHTML = `<a class="page-link">æ˜¾ç¤ºç¬¬ ${start}-${end} æ¡ï¼Œå…± ${filteredCompaniesData.length} æ¡</a>`;
            pagination.appendChild(infoLi);
        }

        function changeCompaniesPage(page) {
            const totalPages = Math.ceil(filteredCompaniesData.length / companiesPageSize);
            if (page >= 1 && page <= totalPages) {
                companiesCurrentPage = page;
                displayCompaniesData();
            }
            return false;
        }

        function changePageSize() {
            companiesPageSize = parseInt(document.getElementById('pageSize').value);
            companiesCurrentPage = 1;
            displayCompaniesData();
        }

        function searchCompanies() {
            const searchTerm = document.getElementById('companySearch').value.toLowerCase();
            const industryFilter = document.getElementById('industryFilter').value;

            filteredCompaniesData = allCompaniesData.filter(company => {
                const matchesSearch = company.name.toLowerCase().includes(searchTerm);
                const matchesIndustry = !industryFilter || company.industry === industryFilter;
                return matchesSearch && matchesIndustry;
            });

            companiesCurrentPage = 1;
            updateCompaniesStats();
            displayCompaniesData();
        }

        function filterCompanies() {
            searchCompanies();
        }

        
        // æ˜¾ç¤ºä¼ä¸šåˆ—è¡¨
        function displayCompanies(companies) {
            console.log(`å¼€å§‹æ˜¾ç¤º ${companies.length} å®¶ä¼ä¸šæ•°æ®`);
            allCompanies = companies;
            companyCurrentPage = 1;
            displayCompaniesPage();
        }

        function displayCompaniesPage(filteredCompanies = null) {
            const companiesDiv = document.getElementById('companiesList');
            const companiesToDisplay = filteredCompanies || allCompanies;
            const totalPages = Math.ceil(companiesToDisplay.length / companiesPerPage);
            const startIndex = (companyCurrentPage - 1) * companiesPerPage;
            const endIndex = startIndex + companiesPerPage;
            const currentPageCompanies = companiesToDisplay.slice(startIndex, endIndex);

            console.log(`æ˜¾ç¤ºç¬¬${companyCurrentPage}é¡µï¼Œå…±${totalPages}é¡µï¼Œå½“å‰é¡µ${currentPageCompanies.length}æ¡è®°å½•`);

            let html = `
                <div class="table-responsive">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="text-muted">
                            æ˜¾ç¤º ${startIndex + 1}-${Math.min(endIndex, companiesToDisplay.length)} æ¡ï¼Œå…± ${companiesToDisplay.length} æ¡è®°å½•
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <label for="pageSizeSelect" class="form-label mb-0">æ¯é¡µæ˜¾ç¤º:</label>
                            <select id="pageSizeSelect" class="form-select form-select-sm" style="width: auto;" onchange="changePageSize(this.value)">
                                <option value="10" ${companiesPerPage === 10 ? 'selected' : ''}>10</option>
                                <option value="20" ${companiesPerPage === 20 ? 'selected' : ''}>20</option>
                                <option value="50" ${companiesPerPage === 50 ? 'selected' : ''}>50</option>
                                <option value="100" ${companiesPerPage === 100 ? 'selected' : ''}>100</option>
                            </select>
                        </div>
                    </div>
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ä¼ä¸šåç§°</th>
                                <th>æ‰€å±è¡Œä¸š</th>
                                <th>æ‰€åœ¨åœ°åŒº</th>
                                <th>å‘˜å·¥æ•°</th>
                                <th>æ³¨å†Œèµ„æœ¬</th>
                                <th>ESGè¯„åˆ†</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            currentPageCompanies.forEach(company => {
                const esgScore = company.esg_score || Math.floor(Math.random() * 30) + 60;
                const scoreColor = esgScore >= 80 ? 'success' : esgScore >= 70 ? 'warning' : 'danger';

                html += `
                    <tr>
                        <td>
                            <div>
                                <strong>${company.name}</strong>
                                <br>
                                <small class="text-muted">æˆç«‹: ${company.established_date}</small>
                            </div>
                        </td>
                        <td><span class="badge bg-info">${company.industry}</span></td>
                        <td>${company.location}</td>
                        <td><span class="badge bg-light text-dark">${company.employees}</span></td>
                        <td>
                            <span class="text-nowrap">Â¥${(company.registered_capital/10000).toFixed(0)}ä¸‡</span>
                        </td>
                        <td>
                            <div class="d-flex align-items-center">
                                <span class="badge bg-${scoreColor} me-2">${esgScore}</span>
                                <small class="text-muted">åˆ†</small>
                            </div>
                        </td>
                        <td><small>${company.last_evaluation}</small></td>
                        <td>
                            <span class="badge ${company.is_active ? 'bg-success' : 'bg-secondary'}">
                                ${company.is_active ? 'æ´»è·ƒ' : 'æœªæ¿€æ´»'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="viewCompanyDetails(${company.id})">
                                <i class="bi bi-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                </div>

                <!-- åˆ†é¡µå¯¼èˆª -->
                <div class="d-flex justify-content-between align-items-center mt-3">
                    <div class="text-muted">
                        æ˜¾ç¤ºç¬¬ ${startIndex + 1}-${Math.min(endIndex, companiesToDisplay.length)} æ¡ï¼Œå…± ${companiesToDisplay.length} æ¡è®°å½•
                    </div>
                    <nav aria-label="ä¼ä¸šåˆ—è¡¨åˆ†é¡µ">
                        <ul class="pagination pagination-sm mb-0">
                            <li class="page-item ${companyCurrentPage === 1 ? 'disabled' : ''}">
                                <a class="page-link" href="#" onclick="changeCompanyPage(${companyCurrentPage - 1}); return false;">
                                    <i class="bi bi-chevron-left"></i> ä¸Šä¸€é¡µ
                                </a>
                            </li>
            `;

            // ç”Ÿæˆé¡µç 
            const maxVisiblePages = 5;
            let startPage = Math.max(1, companyCurrentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }

            for (let i = startPage; i <= endPage; i++) {
                html += `
                    <li class="page-item ${i === companyCurrentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changeCompanyPage(${i}); return false;">${i}</a>
                    </li>
                `;
            }

            html += `
                            <li class="page-item ${companyCurrentPage === totalPages ? 'disabled' : ''}">
                                <a class="page-link" href="#" onclick="changeCompanyPage(${companyCurrentPage + 1}); return false;">
                                    ä¸‹ä¸€é¡µ <i class="bi bi-chevron-right"></i>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            `;

            console.log('ç”Ÿæˆçš„HTMLé•¿åº¦:', html.length);
            console.log('HTMLå‰500å­—ç¬¦:', html.substring(0, 500));
            companiesDiv.innerHTML = html;
            console.log('å·²è®¾ç½®innerHTMLï¼Œè¡¨æ ¼è¡Œæ•°:', document.querySelectorAll('#companiesList tbody tr').length);
        }

        // å¡«å……ç­›é€‰å™¨
        function populateFilters(companies) {
            const industryFilter = document.getElementById('industryFilter');
            const industries = [...new Set(companies.map(c => c.industry))];

            industryFilter.innerHTML = '<option value="">æ‰€æœ‰è¡Œä¸š</option>';
            industries.forEach(industry => {
                industryFilter.innerHTML += `<option value="${industry}">${industry}</option>`;
            });
        }

        // æœç´¢ä¼ä¸š
        
        // æŒ‰è¡Œä¸šç­›é€‰
        function filterByIndustry() {
            applyFilters();
        }

        // æŒ‰çŠ¶æ€ç­›é€‰
        function filterByStatus() {
            applyFilters();
        }

        // åº”ç”¨æ‰€æœ‰ç­›é€‰æ¡ä»¶
        function applyFilters() {
            const searchTerm = document.getElementById('companySearch').value.toLowerCase();
            const industry = document.getElementById('industryFilter').value;
            const status = document.getElementById('statusFilter').value;

            let filteredCompanies = allCompanies.filter(company => {
                const matchesSearch = !searchTerm || company.name.toLowerCase().includes(searchTerm);
                const matchesIndustry = !industry || company.industry === industry;
                const matchesStatus = !status ||
                    (status === 'active' && company.is_active) ||
                    (status === 'inactive' && !company.is_active);

                return matchesSearch && matchesIndustry && matchesStatus;
            });

            companyCurrentPage = 1;
            displayCompaniesPage(filteredCompanies);
        }

        
        // æ’åºä¼ä¸š
        function sortCompanies() {
            const sortBy = document.getElementById('sortBy').value;
            const tbody = document.querySelector('#companiesList tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));

            rows.sort((a, b) => {
                let aValue, bValue;

                switch(sortBy) {
                    case 'id':
                        aValue = parseInt(a.querySelector('td:nth-child(1)').textContent);
                        bValue = parseInt(b.querySelector('td:nth-child(1)').textContent);
                        break;
                    case 'name':
                        aValue = a.querySelector('td:nth-child(2) strong').textContent;
                        bValue = b.querySelector('td:nth-child(2) strong').textContent;
                        return aValue.localeCompare(bValue);
                    case 'esg_score':
                        aValue = parseInt(a.querySelector('td:nth-child(7) .badge').textContent);
                        bValue = parseInt(b.querySelector('td:nth-child(7) .badge').textContent);
                        break;
                    case 'employees':
                        aValue = parseInt(a.querySelector('td:nth-child(5) .badge').textContent);
                        bValue = parseInt(b.querySelector('td:nth-child(5) .badge').textContent);
                        break;
                }

                return aValue - bValue;
            });

            rows.forEach(row => tbody.appendChild(row));
        }

        // æŸ¥çœ‹ä¼ä¸šè¯¦æƒ…
        function viewCompanyDetails(companyId) {
            alert(`æŸ¥çœ‹ä¼ä¸š ${companyId} çš„è¯¦ç»†ä¿¡æ¯`);
            // è¿™é‡Œå¯ä»¥æ‰“å¼€ä¸€ä¸ªæ¨¡æ€æ¡†æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
        }

        // ESGè¯„åˆ†æ˜¾ç¤ºæ›´æ–°
        function updateScoreDisplay(scoreId, value) {
            document.getElementById(scoreId + '-display').textContent = value;
        }

        // ESGè¯„ä»·è¡¨å•æäº¤
        document.getElementById('esgForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = {
                company_id: parseInt(document.getElementById('companyId').value),
                environmental_score: parseInt(document.getElementById('environmentalScore').value),
                social_score: parseInt(document.getElementById('socialScore').value),
                governance_score: parseInt(document.getElementById('governanceScore').value)
            };

            try {
                const response = await fetch(`${API_BASE}/api/v1/esg/evaluate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.success) {
                    displayEsgResult(result.data);
                } else {
                    showNotification('ESGè¯„ä»·å¤±è´¥', 'error');
                }
            } catch (error) {
                showNotification('ç½‘ç»œé”™è¯¯', 'error');
                console.error('ESGè¯„ä»·å¤±è´¥:', error);
            }
        });

        // æ˜¾ç¤ºESGè¯„ä»·ç»“æœ
        function displayEsgResult(data) {
            const resultDiv = document.getElementById('esgResult');

            const gradeColors = {
                'A+': 'success',
                'A': 'success',
                'B+': 'warning',
                'B': 'warning',
                'C+': 'danger',
                'C': 'danger'
            };

            const gradeColor = gradeColors[data.evaluation_grade] || 'secondary';

            resultDiv.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <i class="bi bi-award"></i> è¯„ä»·ç»“æœ
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-6">
                                <h6>ä¼ä¸šåç§°</h6>
                                <p class="fw-bold">${data.company_name}</p>
                            </div>
                            <div class="col-6">
                                <h6>æ‰€å±è¡Œä¸š</h6>
                                <p class="fw-bold">${data.industry}</p>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-6">
                                <h6>ç»¼åˆè¯„åˆ†</h6>
                                <h3><span class="badge bg-${gradeColor} fs-3">${data.overall_score}</span></h3>
                            </div>
                            <div class="col-6">
                                <h6>è¯„ä»·ç­‰çº§</h6>
                                <h3><span class="badge bg-${gradeColor} fs-3">${data.evaluation_grade}</span></h3>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-4">
                                <h6>ç¯å¢ƒè¯„åˆ†</h6>
                                <div class="progress">
                                    <div class="progress-bar bg-success" style="width: ${data.environmental_score}%"></div>
                                </div>
                                <small class="text-muted">${data.environmental_score} åˆ†</small>
                            </div>
                            <div class="col-4">
                                <h6>ç¤¾ä¼šè¯„åˆ†</h6>
                                <div class="progress">
                                    <div class="progress-bar bg-info" style="width: ${data.social_score}%"></div>
                                </div>
                                <small class="text-muted">${data.social_score} åˆ†</small>
                            </div>
                            <div class="col-4">
                                <h6>æ²»ç†è¯„åˆ†</h6>
                                <div class="progress">
                                    <div class="progress-bar bg-warning" style="width: ${data.governance_score}%"></div>
                                </div>
                                <small class="text-muted">${data.governance_score} åˆ†</small>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <h6><i class="bi bi-lightbulb"></i> æ”¹è¿›å»ºè®®</h6>
                            <p>${data.suggestion}</p>
                        </div>

                        <div class="row text-muted small">
                            <div class="col-6">
                                <i class="bi bi-shield-check"></i> ç½®ä¿¡åº¦: ${(data.confidence_level * 100).toFixed(0)}%
                            </div>
                            <div class="col-6">
                                <i class="bi bi-clock"></i> è¯„ä»·æ—¶é—´: ${new Date().toLocaleString()}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            showNotification('ESGè¯„ä»·å®Œæˆ', 'success');
        }

        // åŠ è½½ESGå†å²è®°å½•
        async function loadEsgHistory() {
            const historyCard = document.getElementById('esgHistoryCard');
            const historyList = document.getElementById('esgHistoryList');

            historyCard.style.display = 'block';
            historyList.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

            try {
                const response = await fetch(`${API_BASE}/api/v1/esg/history?limit=10`);
                const data = await response.json();

                if (data.success && data.data) {
                    displayEsgHistory(data.data);
                } else {
                    historyList.innerHTML = '<p class="text-warning">æš‚æ— å†å²è®°å½•</p>';
                }
            } catch (error) {
                historyList.innerHTML = '<p class="text-danger">åŠ è½½å†å²è®°å½•å¤±è´¥</p>';
                console.error('åŠ è½½ESGå†å²è®°å½•å¤±è´¥:', error);
            }
        }

        // æ˜¾ç¤ºESGå†å²è®°å½•
        function displayEsgHistory(history) {
            const historyList = document.getElementById('esgHistoryList');

            let html = '<div class="table-responsive"><table class="table table-sm">';
            html += `
                <thead>
                    <tr>
                        <th>ä¼ä¸šåç§°</th>
                        <th>è¡Œä¸š</th>
                        <th>ESGè¯„åˆ†</th>
                        <th>ç­‰çº§</th>
                        <th>è¯„ä»·æ—¥æœŸ</th>
                        <th>ç½®ä¿¡åº¦</th>
                    </tr>
                </thead>
                <tbody>
            `;

            history.forEach(record => {
                const gradeColors = {
                    'A+': 'success',
                    'A': 'success',
                    'B+': 'warning',
                    'B': 'warning',
                    'C+': 'danger',
                    'C': 'danger'
                };
                const gradeColor = gradeColors[record.grade] || 'secondary';

                html += `
                    <tr>
                        <td>${record.company_name}</td>
                        <td>${record.industry}</td>
                        <td><span class="badge bg-${gradeColor}">${record.overall_score}</span></td>
                        <td><span class="badge bg-${gradeColor}">${record.grade}</span></td>
                        <td>${record.evaluation_date}</td>
                        <td><small>${(record.confidence_level * 100).toFixed(0)}%</small></td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            historyList.innerHTML = html;
        }

        // ç¢³èµ„äº§ä¼°å€¼è¡¨å•æäº¤å‡½æ•°
        async function submitCarbonValuation(e) {
            e.preventDefault();

            // æ ¹æ®é¡¹ç›®ç±»å‹æ˜ å°„åˆ°ç¢³èµ„äº§ç±»å‹
            const projectType = document.getElementById('projectType').value;
            let carbonType = 'cer'; // é»˜è®¤å€¼
            if (projectType === 'forestation') carbonType = 'ccer';
            else if (projectType === 'renewable') carbonType = 'cer';
            else if (projectType === 'energy_efficiency') carbonType = 'ver';

            const formData = {
                type: carbonType,
                amount: parseFloat(document.getElementById('carbonAmount').value),
                project_years: parseInt(document.getElementById('projectYear').value),
                project_type: projectType,
                project_location: document.getElementById('projectLocation').value
            };

            // éªŒè¯è¡¨å•æ•°æ®
            if (!formData.amount || !formData.project_years || !formData.project_location) {
                showNotification('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ', 'warning');
                return;
            }

            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                const submitBtn = document.querySelector('#carbonForm button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> è®¡ç®—ä¸­...';
                submitBtn.disabled = true;

                const response = await fetch(`${API_BASE}/api/v1/carbon/valuation`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.success) {
                    displayCarbonResult(result.data);
                    showNotification('ç¢³èµ„äº§ä¼°å€¼è®¡ç®—å®Œæˆ', 'success');
                } else {
                    showNotification('ç¢³èµ„äº§ä¼°å€¼å¤±è´¥: ' + (result.message || 'æœªçŸ¥é”™è¯¯'), 'error');
                }
            } catch (error) {
                showNotification('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
                console.error('ç¢³èµ„äº§ä¼°å€¼å¤±è´¥:', error);
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                const submitBtn = document.querySelector('#carbonForm button[type="submit"]');
                submitBtn.innerHTML = '<i class="bi bi-currency-dollar"></i> å¼€å§‹è®¡ç®—ä¼°å€¼';
                submitBtn.disabled = false;
            }
        }

        // æ˜¾ç¤ºç¢³èµ„äº§ä¼°å€¼ç»“æœ
        function displayCarbonResult(data) {
            const resultDiv = document.getElementById('carbonResult');

            resultDiv.innerHTML = `
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <i class="bi bi-graph-up-arrow"></i> ç¢³èµ„äº§ä¼°å€¼ç»“æœ
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h6 class="text-muted">èµ„äº§ç±»å‹</h6>
                                    <span class="badge bg-info fs-6">${data.asset_type}</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h6 class="text-muted">ç¢³æ±‡é‡</h6>
                                    <h3><span class="badge bg-success fs-3">${data.amount.toLocaleString()}</span> å¨</h3>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h6 class="text-muted">é¡¹ç›®å¹´é™</h6>
                                    <h4><span class="badge bg-secondary">${data.project_years} å¹´</span></h4>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h6 class="text-muted">å¸‚åœºä»·æ ¼</h6>
                                        <h4>Â¥${data.market_price.toFixed(2)}/å¨</h4>
                                        <small class="text-muted">åŸºå‡†ä»·: Â¥${data.base_price.toFixed(2)}/å¨</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-primary text-white">
                                    <div class="card-body text-center">
                                        <h6>æ€»ä¼°å€¼</h6>
                                        <h2>Â¥${data.total_value.toLocaleString()}</h2>
                                        <small>å¹´å¢é•¿ç‡: ${data.growth_rate}%</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle"></i>
                                    <strong>ä¼°å€¼è¯¦æƒ…ï¼š</strong>
                                    é£é™©ç­‰çº§: <span class="badge bg-warning">${data.risk_level}</span> |
                                    ä¼°å€¼æ–¹æ³•: <span class="badge bg-secondary">${data.valuation_method}</span> |
                                    è®¡ç®—æ—¶é—´: <small>${data.calculation_time}</small>
                                </div>
                            </div>
                                        </div>
                </div>
            `;

            showNotification('ç¢³èµ„äº§ä¼°å€¼å®Œæˆ', 'success');
        }

        // åŠ è½½ç¢³èµ„äº§åˆ—è¡¨
        async function loadCarbonAssets() {
            const assetsDiv = document.getElementById('carbonAssetsList');
            assetsDiv.innerHTML = `
                <div class="text-center py-5">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="visually-hidden">åŠ è½½ä¸­...</span>
                    </div>
                    <p class="text-muted">æ­£åœ¨åŠ è½½ç¢³èµ„äº§é¡¹ç›®æ•°æ®...</p>
                </div>`;

            try {
                // æ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…åº”è¯¥è°ƒç”¨API
                setTimeout(() => {
                    const mockAssets = [
                        { id: 1, type: 'æ—ä¸šç¢³æ±‡', location: 'äº‘å—çœ', amount: 15000, value: 4500000, status: 'active', year: 2023 },
                        { id: 2, type: 'å¯å†ç”Ÿèƒ½æº', location: 'å†…è’™å¤', amount: 28000, value: 8400000, status: 'active', year: 2024 },
                        { id: 3, type: 'èŠ‚èƒ½æ”¹é€ ', location: 'æ±Ÿè‹çœ', amount: 12000, value: 3600000, status: 'pending', year: 2023 },
                        { id: 4, type: 'ç”²çƒ·å›æ”¶', location: 'å››å·çœ', amount: 8000, value: 2400000, status: 'active', year: 2024 },
                        { id: 5, type: 'ç”Ÿç‰©è´¨èƒ½æº', location: 'å±±ä¸œçœ', amount: 20000, value: 6000000, status: 'active', year: 2024 },
                        { id: 6, type: 'æ—ä¸šç¢³æ±‡', location: 'åŒ—äº¬å¸‚', amount: 10000, value: 3500000, status: 'active', year: 2022 },
                        { id: 7, type: 'å¯å†ç”Ÿèƒ½æº', location: 'ä¸Šæµ·å¸‚', amount: 25000, value: 9000000, status: 'active', year: 2024 },
                        { id: 8, type: 'èŠ‚èƒ½æ”¹é€ ', location: 'å¹¿å·å¸‚', amount: 18000, value: 5400000, status: 'pending', year: 2023 }
                    ];

                    allCarbonAssets = mockAssets;
                    filteredCarbonAssets = mockAssets;

                    updateCarbonStats();
                    displayCarbonAssets(filteredCarbonAssets);
                }, 1000);
            } catch (error) {
                assetsDiv.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-exclamation-triangle text-danger" style="font-size: 3rem;"></i>
                        <p class="text-danger mt-3">åŠ è½½ç¢³èµ„äº§æ•°æ®å¤±è´¥</p>
                        <button class="btn btn-outline-primary" onclick="loadCarbonAssets()">é‡æ–°åŠ è½½</button>
                    </div>`;
                console.error('åŠ è½½ç¢³èµ„äº§æ•°æ®å¤±è´¥:', error);
            }
        }

        // æ›´æ–°ç¢³èµ„äº§ç»Ÿè®¡ä¿¡æ¯
        function updateCarbonStats() {
            const totalProjects = filteredCarbonAssets.length;
            const totalCarbon = filteredCarbonAssets.reduce((sum, asset) => sum + asset.amount, 0);
            const totalValue = filteredCarbonAssets.reduce((sum, asset) => sum + asset.value, 0);
            const avgPrice = totalCarbon > 0 ? totalValue / totalCarbon : 0;

            document.getElementById('totalProjects').textContent = totalProjects;
            document.getElementById('totalCarbon').textContent = totalCarbon.toLocaleString();
            document.getElementById('totalValue').textContent = `Â¥${totalValue.toLocaleString()}`;
            document.getElementById('avgPrice').textContent = `Â¥${avgPrice.toFixed(2)}`;
            document.getElementById('projectCount').textContent = `${totalProjects} ä¸ªé¡¹ç›®`;
        }

        // æœç´¢ç¢³èµ„äº§
        function searchCarbonAssets() {
            applyCarbonFilters();
        }

        // ç­›é€‰ç¢³èµ„äº§
        function filterCarbonAssets() {
            applyCarbonFilters();
        }

        // åº”ç”¨ç¢³èµ„äº§ç­›é€‰æ¡ä»¶
        function applyCarbonFilters() {
            const searchTerm = document.getElementById('carbonSearch').value.toLowerCase();
            const typeFilter = document.getElementById('carbonTypeFilter').value;
            const locationFilter = document.getElementById('carbonLocationFilter').value;

            filteredCarbonAssets = allCarbonAssets.filter(asset => {
                const matchesSearch = !searchTerm ||
                    asset.type.toLowerCase().includes(searchTerm) ||
                    asset.location.toLowerCase().includes(searchTerm) ||
                    asset.id.toString().includes(searchTerm);

                const matchesType = !typeFilter || asset.type === typeFilter;
                const matchesLocation = !locationFilter || asset.location === locationFilter;

                return matchesSearch && matchesType && matchesLocation;
            });

            updateCarbonStats();
            displayCarbonAssets(filteredCarbonAssets);
        }

        // æ˜¾ç¤ºç¢³èµ„äº§åˆ—è¡¨
        function displayCarbonAssets(assets) {
            const assetsDiv = document.getElementById('carbonAssetsList');

            if (assets.length === 0) {
                assetsDiv.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-inbox text-muted" style="font-size: 3rem;"></i>
                        <h5 class="text-muted mt-3">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç¢³èµ„äº§é¡¹ç›®</h5>
                        <p class="text-muted">è¯·å°è¯•è°ƒæ•´æœç´¢æˆ–ç­›é€‰æ¡ä»¶</p>
                        <button class="btn btn-outline-primary" onclick="resetCarbonFilters()">é‡ç½®ç­›é€‰</button>
                    </div>`;
                return;
            }

            let html = '<div class="table-responsive"><table class="table table-hover">';
            html += `
                <thead class="table-light">
                    <tr>
                        <th><i class="bi bi-hash"></i> é¡¹ç›®ç¼–å·</th>
                        <th><i class="bi bi-tag"></i> é¡¹ç›®ç±»å‹</th>
                        <th><i class="bi bi-geo-alt"></i> é¡¹ç›®åœ°ç‚¹</th>
                        <th><i class="bi bi-cloud"></i> ç¢³æ±‡é‡</th>
                        <th><i class="bi bi-currency-dollar"></i> èµ„äº§ä¼°å€¼</th>
                        <th><i class="bi bi-info-circle"></i> çŠ¶æ€</th>
                        <th><i class="bi bi-gear"></i> æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
            `;

            assets.forEach(asset => {
                const statusBadge = asset.status === 'active' ?
                    '<span class="badge bg-success"><i class="bi bi-check-circle"></i> è¿è¥ä¸­</span>' :
                    '<span class="badge bg-warning"><i class="bi bi-clock"></i> å¾…å®¡æ ¸</span>';

                const typeIcon = {
                    'æ—ä¸šç¢³æ±‡': 'ğŸŒ³',
                    'å¯å†ç”Ÿèƒ½æº': 'âš¡',
                    'èŠ‚èƒ½æ”¹é€ ': 'ğŸ’¡',
                    'ç”²çƒ·å›æ”¶': 'ğŸ”¥',
                    'ç”Ÿç‰©è´¨èƒ½æº': 'ğŸŒ¾'
                }[asset.type] || 'ğŸ“Š';

                const pricePerTon = asset.amount > 0 ? (asset.value / asset.amount).toFixed(2) : '0.00';

                html += `
                    <tr class="align-middle">
                        <td><span class="badge bg-primary">#${asset.id}</span></td>
                        <td>
                            <div>
                                <strong>${typeIcon} ${asset.type}</strong>
                                ${asset.year ? `<br><small class="text-muted">å¹´ä»½: ${asset.year}</small>` : ''}
                            </div>
                        </td>
                        <td>
                            <div>
                                <i class="bi bi-geo-alt-fill text-danger"></i> ${asset.location}
                            </div>
                        </td>
                        <td>
                            <div>
                                <strong class="text-success">${asset.amount.toLocaleString()}</strong>
                                <br><small class="text-muted">å¨COâ‚‚</small>
                            </div>
                        </td>
                        <td>
                            <div>
                                <strong class="text-primary">Â¥${asset.value.toLocaleString()}</strong>
                                <br><small class="text-muted">å•ä»·: Â¥${pricePerTon}/å¨</small>
                            </div>
                        </td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                <button class="btn btn-info" onclick="viewCarbonDetails(${asset.id})" title="æŸ¥çœ‹è¯¦æƒ…">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button class="btn btn-warning" onclick="editCarbonAsset(${asset.id})" title="ç¼–è¾‘é¡¹ç›®">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-danger" onclick="deleteCarbonAsset(${asset.id})" title="åˆ é™¤é¡¹ç›®">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            assetsDiv.innerHTML = html;
        }

        // é‡ç½®ç¢³èµ„äº§ç­›é€‰
        function resetCarbonFilters() {
            document.getElementById('carbonSearch').value = '';
            document.getElementById('carbonTypeFilter').value = '';
            document.getElementById('carbonLocationFilter').value = '';

            filteredCarbonAssets = [...allCarbonAssets];
            updateCarbonStats();
            displayCarbonAssets(filteredCarbonAssets);
        }

        // æŸ¥çœ‹ç¢³èµ„äº§è¯¦æƒ…
        function viewCarbonDetails(assetId) {
            const asset = allCarbonAssets.find(a => a.id === assetId);
            if (asset) {
                const pricePerTon = (asset.value / asset.amount).toFixed(2);
                const detailsHtml = `
                    <div class="row">
                        <div class="col-md-6">
                            <h5><i class="bi bi-tag"></i> åŸºæœ¬ä¿¡æ¯</h5>
                            <p><strong>é¡¹ç›®ç¼–å·:</strong> #${asset.id}</p>
                            <p><strong>é¡¹ç›®ç±»å‹:</strong> ${asset.type}</p>
                            <p><strong>é¡¹ç›®åœ°ç‚¹:</strong> ${asset.location}</p>
                            <p><strong>é¡¹ç›®å¹´ä»½:</strong> ${asset.year || 'æœªçŸ¥'}</p>
                        </div>
                        <div class="col-md-6">
                            <h5><i class="bi bi-graph-up"></i> ä»·å€¼ä¿¡æ¯</h5>
                            <p><strong>ç¢³æ±‡é‡:</strong> ${asset.amount.toLocaleString()} å¨COâ‚‚</p>
                            <p><strong>èµ„äº§ä¼°å€¼:</strong> Â¥${asset.value.toLocaleString()}</p>
                            <p><strong>å•ä»·:</strong> Â¥${pricePerTon}/å¨</p>
                            <p><strong>çŠ¶æ€:</strong> ${asset.status === 'active' ? 'è¿è¥ä¸­' : 'å¾…å®¡æ ¸'}</p>
                        </div>
                    </div>
                `;

                document.getElementById('carbonResult').innerHTML = `
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-success text-white">
                            <i class="bi bi-info-circle"></i> ç¢³èµ„äº§è¯¦æƒ… - #${asset.id}
                        </div>
                        <div class="card-body">
                            ${detailsHtml}
                            <div class="mt-3">
                                <button class="btn btn-primary" onclick="editCarbonAsset(${asset.id})">
                                    <i class="bi bi-pencil"></i> ç¼–è¾‘é¡¹ç›®
                                </button>
                                <button class="btn btn-secondary" onclick="loadCarbonAssets()">
                                    <i class="bi bi-arrow-clockwise"></i> è¿”å›åˆ—è¡¨
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
                document.getElementById('carbonResult').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // æ˜¾ç¤ºæ·»åŠ ç¢³èµ„äº§æ¨¡æ€æ¡†
        function showAddCarbonAssetModal() {
            document.getElementById('carbonAssetModalTitle').innerHTML =
                '<i class="bi bi-plus-circle"></i> æ·»åŠ ç¢³èµ„äº§é¡¹ç›®';
            document.getElementById('carbonAssetForm').reset();
            document.getElementById('carbonAssetId').value = '';

            const modal = new bootstrap.Modal(document.getElementById('carbonAssetModal'));
            modal.show();
        }

        // ç¼–è¾‘ç¢³èµ„äº§
        function editCarbonAsset(assetId) {
            const asset = allCarbonAssets.find(a => a.id === assetId);
            if (asset) {
                document.getElementById('carbonAssetModalTitle').innerHTML =
                    `<i class="bi bi-pencil"></i> ç¼–è¾‘ç¢³èµ„äº§é¡¹ç›® - #${assetId}`;

                // å¡«å……è¡¨å•æ•°æ®
                document.getElementById('carbonAssetId').value = asset.id;
                document.getElementById('modalProjectType').value = asset.type;
                document.getElementById('modalProjectLocation').value = asset.location;
                document.getElementById('modalCarbonAmount').value = asset.amount;
                document.getElementById('modalAssetValue').value = asset.value;
                document.getElementById('modalProjectYear').value = asset.year || 2024;
                document.getElementById('modalProjectStatus').value = asset.status;
                document.getElementById('modalProjectDescription').value = asset.description || '';

                const modal = new bootstrap.Modal(document.getElementById('carbonAssetModal'));
                modal.show();
            }
        }

        // ä¿å­˜ç¢³èµ„äº§
        function saveCarbonAsset() {
            const assetId = document.getElementById('carbonAssetId').value;
            const formData = {
                type: document.getElementById('modalProjectType').value,
                location: document.getElementById('modalProjectLocation').value,
                amount: parseFloat(document.getElementById('modalCarbonAmount').value),
                value: parseFloat(document.getElementById('modalAssetValue').value),
                year: parseInt(document.getElementById('modalProjectYear').value),
                status: document.getElementById('modalProjectStatus').value,
                description: document.getElementById('modalProjectDescription').value
            };

            // éªŒè¯è¡¨å•
            if (!formData.type || !formData.location || !formData.amount || !formData.value) {
                showNotification('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ', 'warning');
                return;
            }

            if (assetId) {
                // ç¼–è¾‘ç°æœ‰é¡¹ç›®
                const index = allCarbonAssets.findIndex(a => a.id === parseInt(assetId));
                if (index !== -1) {
                    allCarbonAssets[index] = { ...allCarbonAssets[index], ...formData };
                    showNotification(`ç¢³èµ„äº§é¡¹ç›® #${assetId} æ›´æ–°æˆåŠŸ`, 'success');
                }
            } else {
                // æ·»åŠ æ–°é¡¹ç›®
                const newAsset = {
                    id: nextCarbonAssetId++,
                    ...formData
                };
                allCarbonAssets.push(newAsset);
                showNotification('ç¢³èµ„äº§é¡¹ç›®æ·»åŠ æˆåŠŸ', 'success');
            }

            // å…³é—­æ¨¡æ€æ¡†å¹¶åˆ·æ–°åˆ—è¡¨
            const modal = bootstrap.Modal.getInstance(document.getElementById('carbonAssetModal'));
            modal.hide();

            // é‡æ–°åº”ç”¨ç­›é€‰å¹¶æ›´æ–°æ˜¾ç¤º
            applyCarbonFilters();
        }

        // åˆ é™¤ç¢³èµ„äº§
        function deleteCarbonAsset(assetId) {
            const asset = allCarbonAssets.find(a => a.id === assetId);
            if (asset) {
                carbonAssetIdToDelete = assetId;

                // æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯
                const typeIcon = {
                    'æ—ä¸šç¢³æ±‡': 'ğŸŒ³',
                    'å¯å†ç”Ÿèƒ½æº': 'âš¡',
                    'èŠ‚èƒ½æ”¹é€ ': 'ğŸ’¡',
                    'ç”²çƒ·å›æ”¶': 'ğŸ”¥',
                    'ç”Ÿç‰©è´¨èƒ½æº': 'ğŸŒ¾'
                }[asset.type] || 'ğŸ“Š';

                document.getElementById('deleteAssetInfo').innerHTML = `
                    <p><strong>é¡¹ç›®ç¼–å·:</strong> #${asset.id}</p>
                    <p><strong>é¡¹ç›®ç±»å‹:</strong> ${typeIcon} ${asset.type}</p>
                    <p><strong>é¡¹ç›®åœ°ç‚¹:</strong> ${asset.location}</p>
                    <p><strong>ç¢³æ±‡é‡:</strong> ${asset.amount.toLocaleString()} å¨COâ‚‚</p>
                    <p><strong>èµ„äº§ä¼°å€¼:</strong> Â¥${asset.value.toLocaleString()}</p>
                `;

                const modal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
                modal.show();
            }
        }

        // ç¡®è®¤åˆ é™¤ç¢³èµ„äº§
        function confirmDeleteCarbonAsset() {
            if (carbonAssetIdToDelete) {
                const index = allCarbonAssets.findIndex(a => a.id === carbonAssetIdToDelete);
                if (index !== -1) {
                    allCarbonAssets.splice(index, 1);
                    showNotification(`ç¢³èµ„äº§é¡¹ç›® #${carbonAssetIdToDelete} åˆ é™¤æˆåŠŸ`, 'success');

                    // å…³é—­æ¨¡æ€æ¡†
                    const modal = bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal'));
                    modal.hide();

                    // é‡æ–°åº”ç”¨ç­›é€‰å¹¶æ›´æ–°æ˜¾ç¤º
                    applyCarbonFilters();

                    carbonAssetIdToDelete = null;
                }
            }
        }

        // ================================================
        // åŒºå—é“¾åŠŸèƒ½æ¨¡å— - å…¨é¢ä¼˜åŒ–ç‰ˆæœ¬
        // ================================================

        // åŠ è½½åŒºå—é“¾äº¤æ˜“è®°å½•ï¼ˆåˆ†é¡µå’Œè¿‡æ»¤ï¼‰
        async function loadBlockchainTransactions(page = 1) {
            const blockchainDiv = document.getElementById('blockchainList');
            blockchainDiv.innerHTML = `
                <div class="text-center py-5">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="visually-hidden">åŠ è½½ä¸­...</span>
                    </div>
                    <p class="text-muted">æ­£åœ¨åŠ è½½åŒºå—é“¾äº¤æ˜“æ•°æ®...</p>
                </div>
            `;

            try {
                const pageSize = parseInt(document.getElementById('blockchainPageSize').value);
                const typeFilter = document.getElementById('txTypeFilter').value;
                const statusFilter = document.getElementById('txStatusFilter').value;
                const searchTerm = document.getElementById('blockchainSearch').value.trim();

                let url = `${API_BASE}/api/v1/blockchain/transactions?page=${page}&page_size=${pageSize}`;

                const response = await fetch(url);
                const data = await response.json();

                if (data.success && data.data) {
                    allBlockchainTransactions = data.data;
                    blockchainTotalCount = data.pagination?.total || data.data.length;
                    blockchainCurrentPage = page;
                    blockchainPageSize = pageSize;

                    // åº”ç”¨è¿‡æ»¤å™¨
                    filteredBlockchainTransactions = filterBlockchainTransactions(
                        allBlockchainTransactions, typeFilter, statusFilter, searchTerm
                    );

                    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                    updateBlockchainStats();

                    // æ›´æ–°å›¾è¡¨
                    updateBlockchainCharts();

                    // æ˜¾ç¤ºäº¤æ˜“è®°å½•
                    displayBlockchainTransactions(filteredBlockchainTransactions);

                    // æ›´æ–°åˆ†é¡µä¿¡æ¯
                    updateBlockchainPagination();
                } else {
                    blockchainDiv.innerHTML = '<div class="alert alert-warning">æš‚æ— äº¤æ˜“è®°å½•</div>';
                }
            } catch (error) {
                console.error('åŠ è½½åŒºå—é“¾æ•°æ®å¤±è´¥:', error);
                blockchainDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i>
                        åŠ è½½åŒºå—é“¾æ•°æ®å¤±è´¥: ${error.message}
                    </div>
                `;
            }
        }

        // è¿‡æ»¤åŒºå—é“¾äº¤æ˜“
        function filterBlockchainTransactions(transactions, typeFilter, statusFilter, searchTerm) {
            return transactions.filter(tx => {
                // ç±»å‹è¿‡æ»¤
                if (typeFilter && tx.transaction_type !== typeFilter) return false;

                // çŠ¶æ€è¿‡æ»¤
                if (statusFilter && tx.status !== statusFilter) return false;

                // æœç´¢è¿‡æ»¤
                if (searchTerm) {
                    const searchLower = searchTerm.toLowerCase();
                    return (
                        tx.transaction_hash.toLowerCase().includes(searchLower) ||
                        tx.from_address.toLowerCase().includes(searchLower) ||
                        tx.to_address.toLowerCase().includes(searchLower) ||
                        tx.block_number.toString().includes(searchLower)
                    );
                }

                return true;
            });
        }

        // æ›´æ–°åŒºå—é“¾ç»Ÿè®¡ä¿¡æ¯
        function updateBlockchainStats() {
            // ä½¿ç”¨APIè¿”å›çš„æ€»æ•°ï¼Œè€Œä¸æ˜¯å½“å‰é¡µçš„æ•°æ®æ¡æ•°
            const total = blockchainTotalCount;

            // åŸºäºå½“å‰é¡µçš„æ•°æ®æ¯”ä¾‹æ¥ä¼°ç®—å…¨é‡çš„ç»Ÿè®¡
            const currentPageConfirmed = allBlockchainTransactions.filter(tx => tx.status === 'confirmed').length;
            const currentPagePending = allBlockchainTransactions.filter(tx => tx.status === 'pending').length;
            const currentPageTotal = allBlockchainTransactions.length;

            // æŒ‰æ¯”ä¾‹ä¼°ç®—å…¨é‡æ•°æ®
            const confirmedRatio = currentPageTotal > 0 ? currentPageConfirmed / currentPageTotal : 0.92;
            const pendingRatio = currentPageTotal > 0 ? currentPagePending / currentPageTotal : 0.08;

            const estimatedConfirmed = Math.floor(total * confirmedRatio);
            const estimatedPending = total - estimatedConfirmed;

            // è®¡ç®—å¹³å‡Gasè´¹ç”¨ï¼ˆåŸºäºå½“å‰é¡µæ•°æ®ï¼‰
            const avgGas = currentPageTotal > 0 ?
                allBlockchainTransactions.reduce((sum, tx) => sum + (tx.gas_fee / 1e18), 0) / currentPageTotal : 0.003;

            document.getElementById('totalTxCount').textContent = total.toLocaleString();
            document.getElementById('txGrowth').textContent = `+${Math.floor(Math.random() * 40 + 15)}`;
            document.getElementById('confirmedTx').textContent = estimatedConfirmed.toLocaleString();
            document.getElementById('confirmRate').textContent = `${((estimatedConfirmed / total) * 100).toFixed(1)}%`;
            document.getElementById('pendingTx').textContent = estimatedPending.toLocaleString();
            document.getElementById('avgWaitTime').textContent = `${(Math.random() * 8 + 3).toFixed(1)}s`;
            document.getElementById('avgGas').textContent = avgGas.toFixed(4);
        }

        // æ›´æ–°åŒºå—é“¾å›¾è¡¨
        function updateBlockchainCharts() {
            updateTxTypeChart();
            updateTxVolumeChart();
        }

        // äº¤æ˜“ç±»å‹åˆ†å¸ƒå›¾è¡¨
        function updateTxTypeChart() {
            const ctx = document.getElementById('txTypeChart');
            if (!ctx) return;

            const txTypes = {};
            allBlockchainTransactions.forEach(tx => {
                txTypes[tx.transaction_type] = (txTypes[tx.transaction_type] || 0) + 1;
            });

            const labels = Object.keys(txTypes);
            const data = Object.values(txTypes);

            if (txTypeChart) {
                txTypeChart.destroy();
            }

            txTypeChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#FF6384',
                            '#36A2EB',
                            '#FFCE56',
                            '#4BC0C0',
                            '#9966FF',
                            '#FF9F40',
                            '#FF6384',
                            '#C9CBCF',
                            '#4BC0C0',
                            '#FF9F40'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        // 24å°æ—¶äº¤æ˜“è¶‹åŠ¿å›¾è¡¨
        function updateTxVolumeChart() {
            const ctx = document.getElementById('txVolumeChart');
            if (!ctx) return;

            // ç”Ÿæˆ24å°æ—¶çš„æ—¶é—´æ ‡ç­¾
            const hours = [];
            const volumes = [];
            for (let i = 23; i >= 0; i--) {
                const hour = new Date();
                hour.setHours(hour.getHours() - i);
                hours.push(hour.getHours() + ':00');
                volumes.push(Math.floor(Math.random() * 50 + 10));
            }

            if (txVolumeChart) {
                txVolumeChart.destroy();
            }

            txVolumeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hours,
                    datasets: [{
                        label: 'äº¤æ˜“æ•°é‡',
                        data: volumes,
                        borderColor: '#36A2EB',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // æ˜¾ç¤ºåŒºå—é“¾äº¤æ˜“è®°å½•ï¼ˆå¢å¼ºç‰ˆï¼‰
        function displayBlockchainTransactions(transactions) {
            const blockchainDiv = document.getElementById('blockchainList');

            if (transactions.length === 0) {
                blockchainDiv.innerHTML = `
                    <div class="alert alert-info text-center">
                        <i class="bi bi-info-circle"></i>
                        æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„äº¤æ˜“è®°å½•
                    </div>
                `;
                document.getElementById('txCount').textContent = '0';
                return;
            }

            document.getElementById('txCount').textContent = transactions.length;

            let html = '<div class="table-responsive"><table class="table table-hover table-sm">';
            html += `
                <thead class="table-light">
                    <tr>
                        <th><i class="bi bi-hash"></i> äº¤æ˜“å“ˆå¸Œ</th>
                        <th><i class="bi bi-tag"></i> ç±»å‹</th>
                        <th><i class="bi bi-box"></i> åŒºå—å·</th>
                        <th><i class="bi bi-currency-exchange"></i> é‡‘é¢</th>
                        <th><i class="bi bi-lightning"></i> Gasè´¹ç”¨</th>
                        <th><i class="bi bi-check-circle"></i> çŠ¶æ€</th>
                        <th><i class="bi bi-clock"></i> æ—¶é—´</th>
                        <th><i class="bi bi-eye"></i> æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
            `;

            transactions.forEach(tx => {
                const statusBadge = tx.status === 'confirmed' ?
                    '<span class="badge bg-success">å·²ç¡®è®¤</span>' :
                    '<span class="badge bg-warning">å¤„ç†ä¸­</span>';

                const typeColors = {
                    'ESGè¯„ä»·è®°å½•': 'primary',
                    'ç¢³èµ„äº§äº¤æ˜“': 'success',
                    'ä¼ä¸šä¿¡æ¯æ›´æ–°': 'info',
                    'æ•°æ®éªŒè¯': 'warning',
                    'æ™ºèƒ½åˆçº¦æ‰§è¡Œ': 'danger',
                    'ç¢³ä¿¡ç”¨å‘è¡Œ': 'dark',
                    'èµ„äº§æŠµæŠ¼': 'secondary',
                    'æ•°æ®å…±äº«æˆæƒ': 'light',
                    'å®¡è®¡è®°å½•': 'dark',
                    'åˆè§„æ£€æŸ¥': 'primary'
                };

                const typeBadge = `<span class="badge bg-${typeColors[tx.transaction_type] || 'secondary'}">${tx.transaction_type}</span>`;

                html += `
                    <tr onclick="showBlockchainTransactionDetail(${tx.id})" style="cursor: pointer;">
                        <td>
                            <code class="text-primary" style="font-size: 0.8rem;" title="${tx.transaction_hash}">
                                ${tx.transaction_hash.substring(0, 10)}...${tx.transaction_hash.substring(-8)}
                            </code>
                        </td>
                        <td>${typeBadge}</td>
                        <td><span class="badge bg-light text-dark">#${tx.block_number}</span></td>
                        <td>
                            ${tx.amount ?
                                `<span class="text-success">Â¥${tx.amount.toLocaleString()}</span>` :
                                '<span class="text-muted">-</span>'
                            }
                        </td>
                        <td>
                            <small class="text-info">
                                ${(tx.gas_fee / 1e18).toFixed(6)} ETH
                            </small>
                        </td>
                        <td>${statusBadge}</td>
                        <td>
                            <small class="text-muted" title="${new Date(tx.timestamp).toLocaleString()}">
                                ${formatRelativeTime(tx.timestamp)}
                            </small>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="event.stopPropagation(); showBlockchainTransactionDetail(${tx.id})">
                                <i class="bi bi-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            blockchainDiv.innerHTML = html;
        }

        // æ ¼å¼åŒ–ç›¸å¯¹æ—¶é—´
        function formatRelativeTime(timestamp) {
            const now = new Date();
            const txTime = new Date(timestamp);
            const diff = now - txTime;

            if (diff < 60000) return 'åˆšåˆš';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}åˆ†é’Ÿå‰`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}å°æ—¶å‰`;
            return `${Math.floor(diff / 86400000)}å¤©å‰`;
        }

        // æ˜¾ç¤ºåŒºå—é“¾äº¤æ˜“è¯¦æƒ…
        function showBlockchainTransactionDetail(txId) {
            const transaction = allBlockchainTransactions.find(tx => tx.id === txId);
            if (!transaction) return;

            currentTransactionDetail = transaction;

            const modalBody = document.getElementById('blockchainModalBody');

            let dataHtml = '';
            if (transaction.data && Object.keys(transaction.data).length > 0) {
                dataHtml = `
                    <div class="mt-3">
                        <h6>äº¤æ˜“æ•°æ®</h6>
                        <div class="bg-light p-3 rounded">
                            <pre class="mb-0">${JSON.stringify(transaction.data, null, 2)}</pre>
                        </div>
                    </div>
                `;
            }

            modalBody.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h6>åŸºæœ¬ä¿¡æ¯</h6>
                        <table class="table table-sm">
                            <tr>
                                <td><strong>äº¤æ˜“å“ˆå¸Œ:</strong></td>
                                <td><code>${transaction.transaction_hash}</code></td>
                            </tr>
                            <tr>
                                <td><strong>åŒºå—å·:</strong></td>
                                <td>${transaction.block_number}</td>
                            </tr>
                            <tr>
                                <td><strong>äº¤æ˜“ç±»å‹:</strong></td>
                                <td>${transaction.transaction_type}</td>
                            </tr>
                            <tr>
                                <td><strong>çŠ¶æ€:</strong></td>
                                <td>${transaction.status === 'confirmed' ?
                                    '<span class="badge bg-success">å·²ç¡®è®¤</span>' :
                                    '<span class="badge bg-warning">å¤„ç†ä¸­</span>'
                                }</td>
                            </tr>
                            <tr>
                                <td><strong>æ—¶é—´:</strong></td>
                                <td>${new Date(transaction.timestamp).toLocaleString()}</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6>äº¤æ˜“è¯¦æƒ…</h6>
                        <table class="table table-sm">
                            <tr>
                                <td><strong>å‘é€æ–¹:</strong></td>
                                <td><code>${transaction.from_address}</code></td>
                            </tr>
                            <tr>
                                <td><strong>æ¥æ”¶æ–¹:</strong></td>
                                <td><code>${transaction.to_address}</code></td>
                            </tr>
                            <tr>
                                <td><strong>é‡‘é¢:</strong></td>
                                <td>${transaction.amount ? 'Â¥' + transaction.amount.toLocaleString() : '-'}</td>
                            </tr>
                            <tr>
                                <td><strong>Gasä½¿ç”¨é‡:</strong></td>
                                <td>${transaction.gas_used.toLocaleString()}</td>
                            </tr>
                            <tr>
                                <td><strong>Gasä»·æ ¼:</strong></td>
                                <td>${(transaction.gas_price / 1e9).toFixed(2)} Gwei</td>
                            </tr>
                            <tr>
                                <td><strong>Gasè´¹ç”¨:</strong></td>
                                <td>${(transaction.gas_fee / 1e18).toFixed(6)} ETH</td>
                            </tr>
                        </table>
                    </div>
                </div>
                ${dataHtml}
            `;

            const modal = new bootstrap.Modal(document.getElementById('blockchainModal'));
            modal.show();
        }

        // å¤åˆ¶äº¤æ˜“å“ˆå¸Œ
        function copyTransactionHash() {
            if (!currentTransactionDetail) return;

            navigator.clipboard.writeText(currentTransactionDetail.transaction_hash).then(() => {
                showNotification('äº¤æ˜“å“ˆå¸Œå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                showNotification('å¤åˆ¶å¤±è´¥', 'error');
            });
        }

        // æ›´æ–°åŒºå—é“¾åˆ†é¡µä¿¡æ¯
        function updateBlockchainPagination() {
            const start = (blockchainCurrentPage - 1) * blockchainPageSize + 1;
            const end = Math.min(blockchainCurrentPage * blockchainPageSize, blockchainTotalCount);

            document.getElementById('blockchainStart').textContent = start;
            document.getElementById('blockchainEnd').textContent = end;
            document.getElementById('blockchainTotal').textContent = blockchainTotalCount;
        }

        // åŒºå—é“¾åˆ†é¡µå‡½æ•°
        function loadBlockchainPage(page) {
            loadBlockchainTransactions(page);
        }

        function loadBlockchainPreviousPage() {
            if (blockchainCurrentPage > 1) {
                loadBlockchainTransactions(blockchainCurrentPage - 1);
            }
        }

        function loadBlockchainNextPage() {
            const maxPage = Math.ceil(blockchainTotalCount / blockchainPageSize);
            if (blockchainCurrentPage < maxPage) {
                loadBlockchainTransactions(blockchainCurrentPage + 1);
            }
        }

        function changeBlockchainPageSize() {
            blockchainCurrentPage = 1;
            loadBlockchainTransactions(1);
        }

        // æœç´¢åŒºå—é“¾äº¤æ˜“
        function searchBlockchain() {
            loadBlockchainTransactions(1);
        }

        // å®æ—¶ç›‘æ§åŒºå—é“¾äº¤æ˜“
        function startRealTimeBlockchain() {
            if (blockchainRealTimeInterval) {
                stopRealTimeBlockchain();
                return;
            }

            showNotification('å¼€å§‹å®æ—¶ç›‘æ§åŒºå—é“¾äº¤æ˜“', 'info');
            loadBlockchainTransactions();

            blockchainRealTimeInterval = setInterval(() => {
                loadBlockchainTransactions(blockchainCurrentPage);
            }, 5000);

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const btn = event.target.closest('button');
            btn.innerHTML = '<i class="bi bi-stop-circle"></i> åœæ­¢ç›‘æ§';
            btn.classList.remove('btn-success');
            btn.classList.add('btn-danger');
        }

        function stopRealTimeBlockchain() {
            if (blockchainRealTimeInterval) {
                clearInterval(blockchainRealTimeInterval);
                blockchainRealTimeInterval = null;
                showNotification('åœæ­¢å®æ—¶ç›‘æ§', 'info');

                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                const btn = document.querySelector('button[onclick="startRealTimeBlockchain()"]');
                if (btn) {
                    btn.innerHTML = '<i class="bi bi-play-circle"></i> å®æ—¶ç›‘æ§';
                    btn.classList.remove('btn-danger');
                    btn.classList.add('btn-success');
                }
            }
        }

        // ç›‘å¬è¿‡æ»¤å™¨å’Œæœç´¢æ¡†å˜åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç»‘å®šåŒºå—é“¾è¿‡æ»¤äº‹ä»¶
            const txTypeFilter = document.getElementById('txTypeFilter');
            const txStatusFilter = document.getElementById('txStatusFilter');
            const blockchainSearch = document.getElementById('blockchainSearch');

            if (txTypeFilter) txTypeFilter.addEventListener('change', () => loadBlockchainTransactions(1));
            if (txStatusFilter) txStatusFilter.addEventListener('change', () => loadBlockchainTransactions(1));
            if (blockchainSearch) {
                blockchainSearch.addEventListener('keyup', (e) => {
                    if (e.key === 'Enter') {
                        loadBlockchainTransactions(1);
                    }
                });
            }
        });

        // åŠ è½½ç³»ç»Ÿç›‘æ§æ•°æ®
        async function loadMonitorData() {
            try {
                const response = await fetch(`${API_BASE}/api/system/status`);
                const data = await response.json();

                // æ›´æ–°ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡
                const cpuUsage = data.system_resources?.cpu_percent || Math.random() * 30 + 40;
                const memoryUsage = data.system_resources?.memory_percent || Math.random() * 20 + 60;
                const diskUsage = data.system_resources?.disk_percent || Math.random() * 15 + 45;

                updateResourceDisplay('cpu', cpuUsage);
                updateResourceDisplay('memory', memoryUsage);
                updateResourceDisplay('disk', diskUsage);
                updateNetworkLatency();

                // æ›´æ–°APIæ€§èƒ½æŒ‡æ ‡
                updateApiMetrics();

                // åˆå§‹åŒ–æ€§èƒ½å›¾è¡¨
                initPerformanceChart();
            } catch (error) {
                console.error('åŠ è½½ç›‘æ§æ•°æ®å¤±è´¥:', error);
                // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                loadMockMonitorData();
            }
        }

        // åŠ è½½æ¨¡æ‹Ÿç›‘æ§æ•°æ®
        function loadMockMonitorData() {
            const cpuUsage = Math.random() * 30 + 40;
            const memoryUsage = Math.random() * 20 + 60;
            const diskUsage = Math.random() * 15 + 45;

            updateResourceDisplay('cpu', cpuUsage);
            updateResourceDisplay('memory', memoryUsage);
            updateResourceDisplay('disk', diskUsage);
            updateNetworkLatency();
            updateApiMetrics();
            initPerformanceChart();
        }

        // æ›´æ–°èµ„æºæ˜¾ç¤º
        function updateResourceDisplay(resource, value) {
            const percentage = Math.round(value);
            document.getElementById(`${resource}Progress`).style.width = `${percentage}%`;
            document.getElementById(`${resource}Usage`).textContent = `${percentage}%`;
        }

        // æ›´æ–°ç½‘ç»œå»¶è¿Ÿ
        function updateNetworkLatency() {
            const latency = Math.floor(Math.random() * 50 + 10);
            document.getElementById('networkProgress').style.width = `${latency}%`;
            document.getElementById('networkLatency').textContent = `${latency}ms`;
        }

        // æ›´æ–°APIæŒ‡æ ‡
        function updateApiMetrics() {
            const apiCalls = Math.floor(Math.random() * 1000 + 2000);
            const responseTime = (Math.random() * 0.3 + 0.1).toFixed(2);
            const errorRate = (Math.random() * 2).toFixed(1);
            const p95ResponseTime = (Math.random() * 0.5 + 0.5).toFixed(2);

            document.getElementById('apiCalls').textContent = apiCalls.toLocaleString();
            document.getElementById('responseTime').textContent = `${responseTime}s`;
            document.getElementById('errorRate').textContent = `${errorRate}%`;
            document.getElementById('p95ResponseTime').textContent = `${p95ResponseTime}s`;
        }

        // åˆå§‹åŒ–æ€§èƒ½å›¾è¡¨
        function initPerformanceChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            if (performanceChart) performanceChart.destroy();

            // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
            const labels = [];
            const data = [];
            for (let i = 23; i >= 0; i--) {
                const time = new Date();
                time.setHours(time.getHours() - i);
                labels.push(time.getHours() + ':00');
                data.push(Math.random() * 100 + 150);
            }

            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'APIå“åº”æ—¶é—´ (ms)',
                        data: data,
                        borderColor: 'rgba(33, 150, 243, 1)',
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // å¼€å§‹ç›‘æ§ï¼ˆå®šæœŸæ›´æ–°æ•°æ®ï¼‰
        function startMonitoring() {
            // æ¯5ç§’æ›´æ–°ä¸€æ¬¡ç›‘æ§æ•°æ®
            setInterval(() => {
                if (currentPage === 'monitoring') {
                    loadMonitorData();
                }
            }, 5000);
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const alertClass = {
                'success': 'alert-success',
                'error': 'alert-danger',
                'warning': 'alert-warning',
                'info': 'alert-info'
            }[type] || 'alert-info';

            const alertHtml = `
                <div class="alert ${alertClass} alert-dismissible fade show position-fixed"
                     style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;">
                    <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info-circle'}"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', alertHtml);

            // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                const alert = document.querySelector('.alert:last-of-type');
                if (alert) {
                    alert.remove();
                }
            }, 3000);
        }

        // å¯¼å‡ºä¼ä¸šæ•°æ®
        function exportCompanies() {
            showNotification('æ­£åœ¨å‡†å¤‡å¯¼å‡ºæ•°æ®...', 'info');
            setTimeout(() => {
                showNotification('ä¼ä¸šæ•°æ®å¯¼å‡ºæˆåŠŸ', 'success');
            }, 1500);
        }

        // åŠ è½½ESGè¯„ä»·çš„ä¼ä¸šåˆ—è¡¨
        async function loadESGCompanies() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/companies?page_size=156`);
                const data = await response.json();

                if (data.success && data.data) {
                    const companySelect = document.getElementById('companyId');
                    companySelect.innerHTML = '<option value="">è¯·é€‰æ‹©ä¼ä¸š...</option>';

                    // æŒ‰ä¼ä¸šåç§°æ’åº
                    const sortedCompanies = data.data.sort((a, b) => a.name.localeCompare(b.name, 'zh-CN'));

                    sortedCompanies.forEach(company => {
                        const option = document.createElement('option');
                        option.value = company.id;
                        option.textContent = `${company.name} (${company.industry})`;
                        companySelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('åŠ è½½ä¼ä¸šåˆ—è¡¨å¤±è´¥:', error);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½ä»ªè¡¨ç›˜æ•°æ®
            loadDashboardData();

            // åŠ è½½ä¼ä¸šåˆ—è¡¨åˆ°ESGè¯„ä»·è¡¨å•
            loadESGCompanies();

            // ç»‘å®šç¢³èµ„äº§ä¼°å€¼è¡¨å•äº‹ä»¶
            const carbonForm = document.getElementById('carbonForm');
            if (carbonForm) {
                carbonForm.addEventListener('submit', submitCarbonValuation);
                console.log('ç¢³èµ„äº§ä¼°å€¼è¡¨å•äº‹ä»¶ç»‘å®šæˆåŠŸ');
            }

            // åˆå§‹åŒ–å·¥å…·æç¤º
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });

        // æ·»åŠ ä¸€äº›äº¤äº’æ•ˆæœ
        document.addEventListener('DOMContentLoaded', function() {
            // ä¸ºæ‰€æœ‰å¡ç‰‡æ·»åŠ æ‚¬åœæ•ˆæœ
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-5px)';
                });
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });
        });

        // åˆ†é¡µç›¸å…³å‡½æ•°
        function changeCompanyPage(page) {
            const totalPages = Math.ceil(allCompanies.length / companiesPerPage);
            if (page >= 1 && page <= totalPages) {
                companyCurrentPage = page;
                displayCompaniesPage();
            }
        }

      </script>

    <!-- ç¢³èµ„äº§ç®¡ç†æ¨¡æ€æ¡† -->
    <div class="modal fade" id="carbonAssetModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="carbonAssetModalTitle">
                        <i class="bi bi-plus-circle"></i> æ·»åŠ ç¢³èµ„äº§é¡¹ç›®
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="carbonAssetForm">
                        <input type="hidden" id="carbonAssetId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">ğŸŒ± é¡¹ç›®ç±»å‹</label>
                                    <select class="form-select" id="modalProjectType" required>
                                        <option value="">è¯·é€‰æ‹©é¡¹ç›®ç±»å‹...</option>
                                        <option value="æ—ä¸šç¢³æ±‡">ğŸŒ³ æ—ä¸šç¢³æ±‡</option>
                                        <option value="å¯å†ç”Ÿèƒ½æº">âš¡ å¯å†ç”Ÿèƒ½æº</option>
                                        <option value="èŠ‚èƒ½æ”¹é€ ">ğŸ’¡ èŠ‚èƒ½æ”¹é€ </option>
                                        <option value="ç”²çƒ·å›æ”¶">ğŸ”¥ ç”²çƒ·å›æ”¶</option>
                                        <option value="ç”Ÿç‰©è´¨èƒ½æº">ğŸŒ¾ ç”Ÿç‰©è´¨èƒ½æº</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">ğŸ“ é¡¹ç›®åœ°ç‚¹</label>
                                    <input type="text" class="form-control" id="modalProjectLocation" placeholder="è¯·è¾“å…¥é¡¹ç›®åœ°ç‚¹" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">â˜ï¸ ç¢³æ±‡é‡ (å¨COâ‚‚)</label>
                                    <input type="number" class="form-control" id="modalCarbonAmount" min="1" step="0.01" placeholder="è¯·è¾“å…¥ç¢³æ±‡é‡" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">ğŸ’° èµ„äº§ä¼°å€¼ (å…ƒ)</label>
                                    <input type="number" class="form-control" id="modalAssetValue" min="0" step="0.01" placeholder="è¯·è¾“å…¥ä¼°å€¼" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">ğŸ“… é¡¹ç›®å¹´ä»½</label>
                                    <input type="number" class="form-control" id="modalProjectYear" min="2020" max="2024" value="2024" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">ğŸ“Š é¡¹ç›®çŠ¶æ€</label>
                                    <select class="form-select" id="modalProjectStatus" required>
                                        <option value="active">ğŸŸ¢ è¿è¥ä¸­</option>
                                        <option value="pending">ğŸŸ¡ å¾…å®¡æ ¸</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">ğŸ“ é¡¹ç›®æè¿°</label>
                            <textarea class="form-control" id="modalProjectDescription" rows="3" placeholder="è¯·è¾“å…¥é¡¹ç›®æè¿°ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle"></i> å–æ¶ˆ
                    </button>
                    <button type="button" class="btn btn-success" onclick="saveCarbonAsset()">
                        <i class="bi bi-check-circle"></i> ä¿å­˜é¡¹ç›®
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- åˆ é™¤ç¡®è®¤æ¨¡æ€æ¡† -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-exclamation-triangle"></i> ç¡®è®¤åˆ é™¤
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <i class="bi bi-trash text-danger" style="font-size: 3rem;"></i>
                        <h5 class="mt-3">æ‚¨ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç¢³èµ„äº§é¡¹ç›®å—ï¼Ÿ</h5>
                        <p class="text-muted">æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼Œåˆ é™¤åæ•°æ®å°†æ— æ³•æ¢å¤ã€‚</p>
                        <div class="alert alert-warning mt-3">
                            <strong>é¡¹ç›®ä¿¡æ¯ï¼š</strong>
                            <div id="deleteAssetInfo"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle"></i> å–æ¶ˆ
                    </button>
                    <button type="button" class="btn btn-danger" onclick="confirmDeleteCarbonAsset()">
                        <i class="bi bi-trash"></i> ç¡®è®¤åˆ é™¤
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>