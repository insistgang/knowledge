# 数学符号定义体系

> **论文**: 基于YOLOv11深度学习的智慧城市井盖状态检测系统
> **用途**: 第2章 方法部分的数学表达规范
> **制定日期**: 2026-02-07

---

## 一、符号总表

### 1.1 输入输出符号

| 符号 | 定义 | 维度/类型 | 说明 |
|------|------|----------|------|
| $I$ | 输入图像 | $H \times W \times 3$ | RGB彩色图像 |
| $H$ | 图像高度 | 标量 | 单位：像素 |
| $W$ | 图像宽度 | 标量 | 单位：像素 |
| $Y$ | 真值标注 | $N \times 6$ | $(x, y, w, h, c, s)$ |
| $\hat{Y}$ | 预测结果 | $M \times 6$ | $(x, y, w, h, c, s)$ |

### 1.2 网络参数符号

| 符号 | 定义 | 维度/类型 | 说明 |
|------|------|----------|------|
| $\theta$ | 网络参数集合 | - | 所有权重和偏置 |
| $\phi$ | Backbone参数 | - | 主干网络参数 |
| $\psi$ | Neck参数 | - | 颈部网络参数 |
| $\omega$ | Head参数 | - | 检测头参数 |

### 1.3 特征表示符号

| 符号 | 定义 | 维度 | 说明 |
|------|------|------|------|
| $\mathcal{F}$ | 多尺度特征集合 | $\{F_2, F_3, F_4, F_5\}$ | 特征金字塔 |
| $F_i$ | 第i层特征图 | $H/2^i \times W/2^i \times C_i$ | stride=$2^i$ |
| $C_i$ | 第i层通道数 | 标量 | 通常$C_5=C_4/2$ |
| $P_i$ | 第i层预测特征 | $H/2^i \times W/2^i \times C_{out}$ | 用于检测的特征 |

### 1.4 检测相关符号

| 符号 | 定义 | 维度/类型 | 说明 |
|------|------|----------|------|
| $b$ | 边界框 | $4 \times 1$ | $(x, y, w, h)$ |
| $b^{gt}$ | 真值边界框 | $4 \times 1$ | Ground truth box |
| $\hat{b}$ | 预测边界框 | $4 \times 1$ | Predicted box |
| $c$ | 类别标签 | 标量 | $c \in \{1, ..., C\}$ |
| $p$ | 类别概率 | $C \times 1$ | Softmax输出 |
| $s$ | 目标置信度 | 标量 | $s \in [0, 1]$ |
| $IoU$ | 交并比 | 标量 | Intersection over Union |

### 1.5 损失函数符号

| 符号 | 定义 | 说明 |
|------|------|------|
| $\mathcal{L}$ | 总损失函数 | Loss |
| $\mathcal{L}_{cls}$ | 分类损失 | Classification Loss |
| $\mathcal{L}_{bbox}$ | 边界框回归损失 | Bounding Box Loss |
| $\mathcal{L}_{dfl}$ | 分布焦点损失 | Distribution Focal Loss |
| $\mathcal{L}_{iou}$ | IoU损失 | IoU Loss |
| $\lambda_i$ | 损失权重 | 平衡各项损失 |

### 1.6 算子符号

| 符号 | 定义 | 说明 |
|------|------|------|
| $\circ$ | 函数复合 | $(f \circ g)(x) = f(g(x))$ |
| $\oplus$ | 特征拼接 | Concatenation |
| $\odot$ | 逐元素乘法 | Element-wise multiplication |
| $\otimes$ | 卷积运算 | Convolution |
| $*$ | 卷积符号 | $f * g$ |
| $\sigma(\cdot)$ | Sigmoid激活 | $\sigma(x) = 1/(1+e^{-x})$ |
| $\text{ReLU}(\cdot)$ | ReLU激活 | $\max(0, x)$ |
| $\text{Softmax}(\cdot)$ | Softmax函数 | $\exp(x_i)/\sum_j \exp(x_j)$ |

### 1.7 集合与索引符号

| 符号 | 定义 | 说明 |
|------|------|------|
| $\mathbb{R}$ | 实数集 | Real numbers |
| $\mathbb{N}$ | 自然数集 | Natural numbers |
| $[N]$ | 整数集合 | $\{1, 2, ..., N\}$ |
| $\forall$ | 全称量词 | "对所有" |
| $\exists$ | 存在量词 | "存在" |
| $\in$ | 属于 | "属于" |
| $\subset$ | 包含于 | "包含于" |

---

## 二、核心公式定义

### 2.1 网络前向传播

#### 2.1.1 Backbone特征提取

$$
\mathcal{F} = f_\phi(I) = \{F_2, F_3, F_4, F_5\}
$$

其中$F_i$表示stride为$2^i$的特征图：

$$
F_i = \text{ConvBlock}_i(I), \quad i \in \{2, 3, 4, 5\}
$$

#### 2.1.2 Neck特征融合

本文提出的自适应多尺度特征融合（AMSFF）：

$$
\tilde{F}_i = \text{AMSFF}(F_{i-1}, F_i, F_{i+1}) = \alpha_i F_i^{up} \oplus \beta_i F_i^{lat} \oplus \gamma_i F_i^{down}
$$

其中权重满足归一化约束：

$$
\alpha_i + \beta_i + \gamma_i = 1, \quad \alpha_i, \beta_i, \gamma_i \geq 0
$$

#### 2.1.3 注意力加权

时空感知注意力（STAA）：

$$
F_i^{att} = \text{STAA}(F_i) = \text{SA}(F_i) \odot \text{TA}(F_i)
$$

空间注意力：

$$
\text{SA}(F_i) = \sigma\left(f^{7\times7}\left(\left[\text{AvgPool}(F_i); \text{MaxPool}(F_i)\right]\right)\right)
$$

通道注意力：

$$
\text{TA}(F_i) = \sigma\left(\text{MLP}(\text{GAP}(F_i)) \cdot \text{MLP}(\text{GMP}(F_i))\right)
$$

#### 2.1.4 检测头预测

解耦检测头（DCH）：

$$
\begin{aligned}
p_i &= \text{Softmax}\left(W_c^{(i)} \cdot \text{ReLU}(\text{BN}(F_i^{att}))\right) \\
\hat{b}_i &= \text{Sigmoid}\left(W_r^{(i)} \cdot \text{ReLU}(\text{BN}(F_i^{att}))\right) \\
s_i &= \sigma\left(W_s^{(i)} \cdot F_i^{att}\right)
\end{aligned}
$$

### 2.2 损失函数

#### 2.2.1 总损失

$$
\mathcal{L} = \lambda_1 \mathcal{L}_{cls} + \lambda_2 \mathcal{L}_{bbox} + \lambda_3 \mathcal{L}_{dfl} + \lambda_4 \mathcal{L}_{iou}
$$

默认设置：$\lambda_1=0.5, \lambda_2=0.25, \lambda_3=0.15, \lambda_4=0.1$

#### 2.2.2 分类损失（BCE Loss）

$$
\mathcal{L}_{cls} = -\frac{1}{N}\sum_{i=1}^{N}\left[y_i \log \hat{y}_i + (1-y_i)\log(1-\hat{y}_i)\right]
$$

#### 2.2.3 边界框损失（CIoU Loss）

$$
\mathcal{L}_{CIoU} = 1 - IoU + \frac{\rho^2(b, b^{gt})}{c^2} + \alpha v
$$

其中：

$$
\begin{aligned}
IoU &= \frac{|b \cap b^{gt}|}{|b \cup b^{gt}|} \\
\rho(b, b^{gt}) &= \sqrt{(x-x^{gt})^2 + (y-y^{gt})^2} \\
c &= \sqrt{(w \cup w^{gt})^2 + (h \cup h^{gt})^2} \\
v &= \frac{4}{\pi^2}\left(\arctan\frac{w^{gt}}{h^{gt}} - \arctan\frac{w}{h}\right)^2
\end{aligned}
$$

#### 2.2.4 分布焦点损失（DFL）

$$
\mathcal{L}_{DFL} = -\sum_{i=1}^{4} (y_i + o) \log(\hat{y}_i), \quad o \in [0, 1]
$$

### 2.3 评估指标

#### 2.3.1 精确率与召回率

$$
\begin{aligned}
\text{Precision} &= \frac{TP}{TP + FP} \\
\text{Recall} &= \frac{TP}{TP + FN}
\end{aligned}
$$

#### 2.3.2 F1分数

$$
F_1 = \frac{2 \cdot \text{Precision} \cdot \text{Recall}}{\text{Precision} + \text{Recall}}
$$

#### 2.3.3 平均精度（AP）

$$
AP = \int_0^1 \text{Precision}(\text{Recall}) \, d\text{Recall}
$$

#### 2.3.4 平均精度均值（mAP）

$$
mAP = \frac{1}{C}\sum_{c=1}^{C} AP_c
$$

---

## 三、方法描述模板

### 3.1 改进点1：高分辨率特征金字塔

**问题定义**：

标准YOLOv11使用$\{P_3, P_4, P_5\}$三层特征金字塔，stride分别为$\{8, 16, 32\}$。对于井盖这类小目标（通常占比$<1\%$），$P_3$层的分辨率仍然不足。

**改进方法**：

引入$P_2$层（stride=4）形成$\{P_2, P_3, P_4, P_5\}$四层特征金字塔：

$$
P_2 = \text{Conv}_{1\times1}\left(\text{Upsample}(F_3)\right) \oplus \text{Conv}_{1\times1}(F_2)
$$

**数学描述**：

设输入图像分辨率为$H \times W$，则$P_2$层特征分辨率为$H/4 \times W/4$，相比$P_3$层的$H/8 \times W/8$保留了4倍的空间细节。

### 3.2 改进点2：自适应多尺度特征融合

**问题定义**：

传统FPN采用自顶向下路径和横向连接：

$$
P_i^{FPN} = \text{Conv}(F_i \oplus \text{Upsample}(P_{i+1}^{FPN}))
$$

这种递归融合方式导致跨层信息传递时存在信息损失。

**改进方法**：

提出AMSFF模块，直接聚合所有层级信息：

$$
P_i^{AMSFF} = \text{Conv}\left(\sum_{j=2}^{5} w_{ij} \cdot \text{Align}(F_j, s_i)\right)
$$

其中$\text{Align}(\cdot, s_i)$表示将特征对齐到stride=$2^i$的尺度，权重$w_{ij}$通过网络学习：

$$
w_{ij} = \frac{\exp(g_{ij})}{\sum_{k=2}^{5}\exp(g_{ik})}, \quad g_{ij} = \text{Gate}(F_i, F_j)
$$

### 3.3 改进点3：时空感知注意力

**空间注意力分支**：

$$
\text{SA}(F) = \sigma\left(W_s \cdot \left[\text{AvgPool}_{sp}(F); \text{MaxPool}_{sp}(F)\right] + b_s\right)
$$

其中$\text{AvgPool}_{sp}$和$\text{MaxPool}_{sp}$分别沿通道维度进行空间池化。

**通道注意力分支**：

$$
\text{TA}(F) = \sigma\left(W_c \cdot \text{ReLU}(W_{c1} \cdot \text{GAP}(F) + b_{c1}) + b_c\right)
$$

其中$\text{GAP}$为全局平均池化。

### 3.4 改进点4：解耦检测头

**分类分支**：

$$
\text{Cls}(F) = \text{Softmax}\left(W_{cls} \cdot \text{ReLU}(\text{BN}(F))\right)
$$

**回归分支**：

$$
\text{Reg}(F) = \text{Sigmoid}\left(W_{reg} \cdot \text{ReLU}(\text{BN}(F))\right)
$$

与传统耦合头相比，解耦头使用独立的参数：

$$
\theta_{DCH} = \{\theta_{cls}, \theta_{reg}\}, \quad \theta_{cls} \cap \theta_{reg} = \emptyset
$$

---

## 四、LaTeX代码模板

### 4.1 符号定义

```latex
\begin{notation}[widest-symbol=$\mathcal{L}_{iou}$]
  \item[$I \in \mathbb{R}^{H \times W \times 3}$] 输入图像
  \item[$Y = \{b^{(i)}, c^{(i)}\}_{i=1}^{N}$] 真值标注集合
  \item[$\mathcal{F} = \{F_2, F_3, F_4, F_5\}$] 多尺度特征集合
  \item[$F_i \in \mathbb{R}^{H/2^i \times W/2^i \times C_i}$] 第$i$层特征图
  \item[$\mathcal{L} = \sum_{k=1}^{4} \lambda_k \mathcal{L}_k$] 总损失函数
\end{notation}
```

### 4.2 核心公式

```latex
% AMSFF融合
\begin{equation}
  \tilde{F}_i = \text{AMSFF}(F_{i-1}, F_i, F_{i+1}) = \alpha_i F_i^{up} \oplus \beta_i F_i^{lat} \oplus \gamma_i F_i^{down}
  \label{eq:amsff}
\end{equation}

% 约束条件
\begin{equation}
  \alpha_i + \beta_i + \gamma_i = 1, \quad \alpha_i, \beta_i, \gamma_i \geq 0
  \label{eq:constraint}
\end{equation}

% CIoU损失
\begin{equation}
  \mathcal{L}_{CIoU} = 1 - IoU + \frac{\rho^2(b, b^{gt})}{c^2} + \alpha v
  \label{eq:ciou}
\end{equation}
```

### 4.3 算法描述

```latex
\begin{algorithm}[H]
  \caption{自适应多尺度特征融合}
  \label{alg:amsff}
  \begin{algorithmic}[1]
    \Require 多尺度特征 $\{F_2, F_3, F_4, F_5\}$
    \Ensure 融合特征 $\{\tilde{F}_2, \tilde{F}_3, \tilde{F}_4, \tilde{F}_5\}$
    \For{each $i \in \{2, 3, 4, 5\}$}
      \State $F_i^{up} \gets \text{Align}(F_{i+1}, s_i)$ \Comment{上采样对齐}
      \State $F_i^{lat} \gets F_i$ \Comment{当前层}
      \State $F_i^{down} \gets \text{Align}(F_{i-1}, s_i)$ \Comment{下采样对齐}
      \State $\{w_{ij}\} \gets \text{Gate}(F_i, F_j), \forall j$ \Comment{计算融合权重}
      \State $\tilde{F}_i \gets \sum_j w_{ij} \cdot F_i^{*}$ \Comment{加权融合}
    \EndFor
    \State \Return $\{\tilde{F}_2, \tilde{F}_3, \tilde{F}_4, \tilde{F}_5\}$
  \end{algorithmic}
\end{algorithm}
```

---

## 五、使用说明

### 5.1 符号使用规范

1. **首次出现**：所有符号首次出现时必须明确定义
2. **一致性**：全文使用统一的符号体系
3. **下标规范**：
   - 网络层级用$i, j, k$
   - 样本索引用$n, m$
   - 通道索引用$c$
   - 位置索引用$(h, w)$或$(i, j)$

### 5.2 公式编号规范

1. **重要公式**：核心公式需要编号（使用`\label{}`）
2. **引用规范**：引用时使用`\eqref{}`或"式(X)"
3. **对齐**：多行公式使用`align`环境对齐

### 5.3 常见错误规避

| 错误类型 | 错误示例 | 正确示例 |
|---------|---------|---------|
| 未定义符号 | 直接使用$F_i$ | 设$F_i$表示第$i$层特征图 |
| 维度不明确 | $F_i \in \mathbb{R}^C$ | $F_i \in \mathbb{R}^{H/2^i \times W/2^i \times C_i}$ |
| 算子混淆 | 使用$+$表示拼接 | 使用$\oplus$表示拼接 |
| 索引越界 | $F_1$（YOLO无$P_1$层） | $F_2$作为最浅层 |

---

## 六、论文对应关系

| 章节 | 使用符号 | 关键公式 |
|------|---------|----------|
| 2.2 YOLOv11总体架构 | $I, \phi, \mathcal{F}$ | 式(1)前向传播 |
| 2.3 改进的多层次特征融合 | $\tilde{F}_i, \alpha_i, \beta_i, \gamma_i$ | 式(2)-(5)AMSFF |
| 2.4 优化的检测头 | $p_i, \hat{b}_i, \theta_{cls}, \theta_{reg}$ | 式(6)-(8)DCH |
| 3.2 评价指标 | $TP, FP, mAP$ | 式(9)-(12)评估 |

---

*文档版本: v1.0*
*最后更新: 2026-02-07*
*维护者: Technical Architect*
