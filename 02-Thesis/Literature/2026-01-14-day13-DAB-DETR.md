#day13 DAB-DETR: Dynamic Anchor Boxes are Better Queries for DETR

今天读DAB-DETR《DAB-DETR: Dynamic Anchor Boxes are Better Queries for DETR》（ICCV 2023，南大&商汤，Shilong Liu等）。

Day08 DETR用learnable query做检测，但收敛慢（300+ epochs）且小目标差。今天DAB-DETR说：query应该用anchor boxes，而不是positional encoding。

核心痛点：DETR的query难以精确定位。

原始DETR的query是learnable embedding + positional encoding，这种方式让query"知道自己在哪"，但不知道"要找什么"。每层decoder都在找同一个位置，只是不断细化分类——这限制了定位能力。

作者的解法：DAB = Dynamic Anchor Boxes作为query。

三大核心改动：

1. Anchor-based query：Query初始化为4D anchor box（x, y, w, h），而不是positional encoding。每个query代表一个"可能的目标框"。
2. Update by residual：每层decoder通过加法更新anchor box坐标，像残差连接一样逐步精修。
3. Position modulation：用更新的anchor位置来调制attention，让每层的focus区域随anchor移动。

关键发现：Anchor回到DETR，收敛速度起飞。

COCO val（ResNet-50）：
50 epochs：DAB-DETR 43.6 AP，DETR只有约35 AP
300 epochs：DAB-DETR 45.7 AP，小目标APs从DETR的20.5提升到24.6

Table 3的消融实验证明：4D anchor query带来+2.2 AP，position modulation带来+1.1 AP，Look Forward Twice技巧带来+0.9 AP。

Table 4显示：DAB-DETR在50 epochs达到43.6 AP，原始DETR需要300+ epochs才能接近。

读后感：
Day08 DETR说"不要anchor"，Day12 YOLOX说"YOLO也不要anchor"。今天DAB-DETR说"在DETR里，anchor其实很有用"。这不是倒退，而是螺旋上升：DAB-DETR的anchor是动态更新的，不是手工设计的；每层都在精修anchor位置，而不是用固定的先验框。后来Conditional DETR、DN-DETR等工作都延续了这一思路。
