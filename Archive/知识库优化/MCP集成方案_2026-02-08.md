# Leo 知识库 MCP 集成方案

> 制定日期：2026-02-08
> 方案版本：v1.0

---

## 1. 执行摘要

基于 Leo 知识库的八大核心场景（读论文、写日记、项目管理、竞赛准备、教资备考、理财规划、技术学习、健康管理），设计了一套轻量级、高价值的 MCP 服务集成方案。

**核心策略**：优先集成「必需型」MCP 服务，谨慎选择「增强型」服务，确保成本可控、价值明显。

---

## 2. MCP 服务推荐清单

### 2.1 必需型服务（P0 - 强烈推荐）

| MCP 服务 | 功能描述 | 匹配场景 | 优先级 | 成本 |
|----------|----------|----------|--------|------|
| **Brave Search MCP** | 网页搜索，无需 API Key | 文献查找、技术资料搜索 | P0 | 免费 |
| **Filesystem MCP** | 本地文件系统操作 | 日记整理、知识库管理 | P0 | 免费 |
| **Memory MCP** | 跨会话记忆存储 | 复盘数据积累、习惯追踪 | P0 | 免费 |
| **GitHub MCP** | 仓库操作、Issue 管理 | 项目管理、代码同步 | P0 | 免费 |
| **SQLite MCP** | 本地数据库查询 | 复盘数据统计、分析 | P0 | 免费 |

### 2.2 增强型服务（P1 - 可选）

| MCP 服务 | 功能描述 | 匹配场景 | 优先级 | 成本 |
|----------|----------|----------|--------|------|
| **Google Drive MCP** | 云盘文件访问 | 论文 PDF 存储、资料备份 | P1 | 免费 |
| **Notion MCP** | Notion 数据库集成 | 任务管理、项目追踪 | P1 | 免费 |
| **Pandoc MCP** | 文档格式转换 | LaTeX、Markdown 转换 | P1 | 免费 |
| **Time MCP** | 时间日期计算 | 复盘周期计算、计划安排 | P1 | 免费 |

### 2.3 锦上添花型（P2 - 谨慎考虑）

| MCP 服务 | 功能描述 | 匹配场景 | 优先级 | 成本 |
|----------|----------|----------|--------|------|
| **Slack MCP** | 团队沟通集成 | 实验室协作（如需要） | P2 | 免费 |
| **Weather MCP** | 天气预报查询 | 日记背景记录 | P2 | 免费 |
| **Mermaid MCP** | 图表生成 | 论文架构图绘制 | P2 | 免费 |

---

## 3. Skills-MCP 集成映射表

| Skill | 必需 MCP | 增强 MCP | 数据流 |
|-------|----------|----------|--------|
| **读论文** | Brave Search, Filesystem, Google Drive | Pandoc | 搜索论文 → 下载 PDF → 解析内容 → 生成笔记 |
| **今日复盘** | Filesystem, Memory, Time | - | 读取日记.md → 整理 → 保存 → 链接记忆 |
| **项目管理** | GitHub, Filesystem, SQLite | - | 读取项目状态 → 更新进度 → 记录历史 |
| **竞赛准备** | Brave Search, Filesystem | Mermaid | 搜索资料 → 整理模板 → 生成图表 |
| **周复盘** | Filesystem, Memory, SQLite, Time | - | 汇总本周日记 → 统计分析 → 生成报告 |
| **月复盘** | Filesystem, Memory, SQLite, Time | - | 汇总本月数据 → 趋势分析 → 生成报告 |

---

## 4. 工作流设计

### 4.1 读论文工作流

```
用户触发「读论文」
    ↓
Brave Search MCP 搜索论文关键词
    ↓
Filesystem MCP 检查本地是否已有 PDF
    ↓
Google Drive MCP 下载/访问 PDF
    ↓
WebReader MCP (已有) 转换网页版论文
    ↓
Image Analysis MCP (已有) 提取图片表格
    ↓
Filesystem MCP 保存文献笔记到 02-Thesis/Literature/
    ↓
Memory MCP 存储论文核心要点供后续检索
    ↓
完成：生成文献笔记 + 知识图谱更新
```

### 4.2 今日复盘工作流

```
用户触发「今日复盘」
    ↓
Filesystem MCP 读取 E:\000\knowledge\日记.md
    ↓
Time MCP 计算今日日期、星期、本周范围
    ↓
解析日记内容（时间线、状态、打卡）
    ↓
Memory MCP 存储今日状态（精力、情绪、健康）
    ↓
Filesystem MCP 保存日记到 01-Daily/YYYY-MM/
    ↓
Filesystem MCP 同步到 Hexo 博客目录
    ↓
Memory MCP 更新习惯追踪数据
    ↓
完成：日记整理 + 博客同步 + 数据积累
```

### 4.3 周复盘工作流

```
用户触发「周复盘」
    ↓
Time MCP 计算本周起止日期
    ↓
Filesystem MCP 读取本周所有日记文件
    ↓
SQLite MCP 查询历史周数据对比
    ↓
Memory MCP 检索本周关键事件
    ↓
统计分析：
  - 平均精力/情绪
  - 习惯完成率
  - 关键成果提取
    ↓
Filesystem MCP 保存周复盘报告
    ↓
Filesystem MCP 同步到 Hexo
    ↓
Memory MCP 更新模式识别结果
    ↓
完成：周复盘报告 + 模式分析
```

### 4.4 项目管理工作流

```
用户触发「项目进度」
    ↓
Memory MCP 检索项目历史状态
    ↓
GitHub MCP 查询相关仓库状态
    ↓
Filesystem MCP 读取项目笔记
    ↓
SQLite MCP 记录进度快照
    ↓
生成项目状态报告
    ↓
用户确认更新
    ↓
Filesystem MCP 更新项目笔记
    ↓
GitHub MCP 提交更新（如需要）
    ↓
完成：项目追踪 + 历史记录
```

---

## 5. 配置文件设计

### 5.1 Claude Desktop MCP 配置

**位置**：`%APPDATA%\Claude\claude_desktop_config.json`

```json
{
  "mcpServers": {
    "brave-search": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-brave-search"],
      "env": {
        "BRAVE_API_KEY": "YOUR_API_KEY_HERE"
      }
    },
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "E:\\000\\knowledge"],
      "env": {
        "ALLOWED_DIRECTORIES": "E:\\000\\knowledge;E:\\000\\Hexo\\source\\_posts"
      }
    },
    "memory": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-memory"],
      "env": {
        "MEMORY_FILE": "E:\\000\\knowledge\\.claude\\memory.json"
      }
    },
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": {
        "GITHUB_TOKEN": "YOUR_GITHUB_TOKEN_HERE"
      }
    },
    "sqlite": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-sqlite", "E:\\000\\knowledge\\.claude\\habits.db"],
      "env": {
        "DATABASE_PATH": "E:\\000\\knowledge\\.claude\\habits.db"
      }
    },
    "google-drive": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-gdrive"],
      "env": {
        "GOOGLE_CREDENTIALS": "PATH_TO_CREDENTIALS_JSON"
      }
    },
    "pandoc": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-pandoc"]
    },
    "time": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-time"]
    }
  }
}
```

### 5.2 权限配置

更新 `E:\000\knowledge\.claude\settings.local.json`：

```json
{
  "permissions": {
    "allow": [
      // 现有权限...
      "Bash(npx -y @modelcontextprotocol/server-filesystem:*)",
      "Bash(npx -y @modelcontextprotocol/server-memory:*)",
      "Bash(npx -y @modelcontextprotocol/server-github:*)",
      "Bash(npx -y @modelcontextprotocol/server-sqlite:*)",
      "Bash(npx -y @modelcontextprotocol/server-brave-search:*)"
    ]
  }
}
```

### 5.3 环境变量

**位置**：`.env` 文件或系统环境变量

```bash
# Brave Search API (免费额度足够个人使用)
BRAVE_API_KEY=your_brave_api_key

# GitHub Personal Access Token
GITHUB_TOKEN=your_github_token

# Google Drive OAuth Credentials
GOOGLE_CREDENTIALS=path/to/credentials.json

# MCP 数据目录
MCP_DATA_DIR=E:\000\knowledge\.claude
```

---

## 6. 安全考虑

### 6.1 权限控制

| MCP 服务 | 风险等级 | 安全措施 |
|----------|----------|----------|
| Filesystem | 高 | 限制 ALLOWED_DIRECTORIES，只读优先 |
| GitHub | 中 | 使用细粒度 Token，只授予 repo 权限 |
| Google Drive | 中 | 使用 OAuth，限制访问范围 |
| Memory | 低 | 本地存储，敏感数据加密 |
| SQLite | 低 | 本地数据库，权限隔离 |

### 6.2 数据隐私

- **Memory MCP**：本地存储，不上传云端
- **SQLite MCP**：本地数据库，个人习惯数据
- **Filesystem MCP**：明确允许目录，禁止访问系统目录

---

## 7. 成本控制策略

### 7.1 免费优先

| 服务 | 免费额度 | 预估用量 | 策略 |
|------|----------|----------|------|
| Brave Search | 2000次/月 | ~100次/月 | 免费额度充足 |
| GitHub | 5000次/小时 | ~50次/月 | 完全免费 |
| Filesystem | 无限制 | 高频使用 | 完全免费 |
| Memory | 无限制 | 高频使用 | 完全免费 |
| SQLite | 无限制 | 中频使用 | 完全免费 |

### 7.2 成本监控

建议每月检查：
- Brave Search API 使用量
- GitHub Token 调用次数
- 总 Token 消耗（MCP 调用会增加）

---

## 8. 失败处理策略

### 8.1 MCP 降级机制

```
MCP 调用失败
    ↓
检测失败类型
    ↓
网络问题 → 降级到本地缓存/基础功能
    ↓
服务不可用 → 跳过该功能，记录警告
    ↓
权限问题 → 提示用户检查配置
    ↓
超时 → 重试 1 次，失败后跳过
```

### 8.2 各 MCP 失败处理

| MCP 服务 | 失败时行为 |
|----------|------------|
| Brave Search | 使用 WebSearch 工具代替 |
| Filesystem | 使用 Read/Glob 工具代替 |
| Memory | 跳过，使用文本解析 |
| GitHub | 手动提示用户操作 |
| SQLite | 跳过统计功能 |
| Google Drive | 使用本地文件代替 |

### 8.3 示例：读论文降级流程

```
Brave Search MCP 失败
    ↓
降级：使用内置 WebSearch 工具
    ↓
WebReader 失败
    ↓
降级：提示用户提供 PDF 路径
    ↓
Image Analysis 失败
    ↓
降级：跳过图片，继续处理文字
    ↓
最终：生成不完整笔记 + 标记缺失内容
```

---

## 9. 实施步骤

### 阶段一：基础集成（第1周）

1. **安装 MCP 基础服务**
   ```bash
   npm install -g @modelcontextprotocol/server-filesystem
   npm install -g @modelcontextprotocol/server-memory
   npm install -g @modelcontextprotocol/server-github
   ```

2. **配置 Claude Desktop**
   - 编辑 `claude_desktop_config.json`
   - 测试每个 MCP 连接

3. **更新 Skills**
   - 修改 `今日复盘skill.md` 集成 Memory MCP
   - 修改 `读论文skill.md` 集成 GitHub MCP

### 阶段二：数据层增强（第2周）

1. **安装 SQLite MCP**
   ```bash
   npm install -g @modelcontextprotocol/server-sqlite
   ```

2. **初始化习惯追踪数据库**
   ```sql
   CREATE TABLE habits (
     date TEXT PRIMARY KEY,
    精力 INTEGER,
     情绪 INTEGER,
     运动 INTEGER,
     喝水 INTEGER,
     论文阅读 INTEGER
   );
   ```

3. **更新周复盘 Skill**
   - 集成 SQLite 查询
   - 生成数据对比图表

### 阶段三：搜索增强（第3周）

1. **安装 Brave Search MCP**
   ```bash
   npm install -g @modelcontextprotocol/server-brave-search
   ```

2. **获取 API Key**
   - 注册 Brave Search API
   - 配置环境变量

3. **更新读论文 Skill**
   - 集成文献搜索
   - 自动查找相关论文

### 阶段四：云服务集成（可选，第4周）

1. **安装 Google Drive MCP**
   ```bash
   npm install -g @modelcontextprotocol/server-gdrive
   ```

2. **配置 OAuth**
   - 创建 Google Cloud 项目
   - 生成 OAuth 凭证

3. **配置论文云存储**
   - 设置自动同步
   - 建立本地-云端映射

---

## 10. 验收标准

| 功能 | 验收条件 |
|------|----------|
| Brave Search | 能搜索论文并返回结果 |
| Filesystem | 能读取指定目录文件 |
| Memory | 能存储和检索跨会话数据 |
| GitHub | 能查询仓库状态 |
| SQLite | 能创建表并插入/查询数据 |
| 今日复盘 | 使用 Memory 存储状态 |
| 周复盘 | 使用 SQLite 生成统计 |
| 读论文 | 使用 Brave Search 查找文献 |

---

## 11. 风险与挑战

### 11.1 已识别风险

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| MCP 服务不稳定 | 功能中断 | 实现降级机制 |
| Token 消耗增加 | 成本上升 | 监控使用量，设置限制 |
| 配置复杂 | 部署困难 | 提供详细文档和脚本 |
| 权限问题 | 安全风险 | 最小权限原则 |

### 11.2 挑战问题解答

**Q1: 哪些 MCP 是必需的，哪些是锦上添花？**
- **必需**：Filesystem、Memory、SQLite（本地核心功能）
- **推荐**：Brave Search、GitHub（增强效率）
- **可选**：Google Drive、Notion（特定场景）

**Q2: MCP 之间如何协作而不冲突？**
- 使用明确的数据流设计
- 每个 MCP 有单一职责
- 通过 Skills 协调调用顺序

**Q3: 如何确保 MCP 调用的成本可控？**
- 优先选择免费服务
- 实现调用频率限制
- 监控 Token 使用

**Q4: 如何处理 MCP 失败的情况？**
- 实现降级机制
- 提供基础功能兜底
- 记录失败日志用于调试

---

## 12. 参考资料

### 官方文档

- [MCP 官方文档](https://modelcontextprotocol.io/)
- [Awesome MCP Servers (GitHub)](https://github.com/wong2/awesome-mcp-servers)
- [Brave Search MCP 文档](https://brave.com/search/api/guides/use-with-claude-desktop-with-mcp/)
- [Awesome MCP 中文资源](https://github.com/yzfly/Awesome-MCP-ZH)

### 社区资源

- [MCP Server Finder](https://www.mcpserverfinder.com/)
- [FastMCP 目录](https://fastmcp.me/)
- [PulseMCP 目录](https://www.pulsemcp.com/servers)

---

## 13. 附录

### A. MCP 服务替代方案

| 官方 MCP | 替代方案 | 何时使用 |
|----------|----------|----------|
| Brave Search | WebSearch 工具 | API 配额用尽 |
| Filesystem | Read/Glob 工具 | MCP 不可用 |
| Memory | 文件缓存 | 本地存储受限 |
| GitHub | Bash git 命令 | Token 问题 |

### B. 实用脚本

**批量安装 MCP 服务器**
```bash
#!/bin/bash
# install-mcp.sh

MCP_SERVERS=(
  "@modelcontextprotocol/server-filesystem"
  "@modelcontextprotocol/server-memory"
  "@modelcontextprotocol/server-github"
  "@modelcontextprotocol/server-sqlite"
  "@modelcontextprotocol/server-brave-search"
  "@modelcontextprotocol/server-pandoc"
  "@modelcontextprotocol/server-time"
)

for server in "${MCP_SERVERS[@]}"; do
  echo "Installing $server..."
  npm install -g "$server"
done

echo "MCP servers installed successfully!"
```

### C. 故障排查清单

- [ ] Claude Desktop 是否重启？
- [ ] npx 是否在 PATH 中？
- [ ] API Key 是否正确配置？
- [ ] 允许的目录是否正确？
- [ ] 防火墙是否阻止连接？
- [ ] 网络代理是否影响 MCP 连接？

---

*方案制定：Claude Opus 4.6 (1M context)*
*最后更新：2026-02-08*
