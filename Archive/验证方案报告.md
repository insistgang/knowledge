# 知识库操作验证方案报告

> 验收员准备版本 | 生成日期: 2026-02-07

---

## 一、操作前基线数据

| 指标 | 当前值 | 备注 |
|------|--------|------|
| 知识库总大小 | 34G | E:\000\knowledge |
| Markdown文件数 | 794 | *.md文件总数 |
| 主要重复源1 | 47M | faceai-master vs faceai-master2 |
| 主要重复源2 | 238M | 两届智慧城市大赛材料 |
| 论文文献数 | 31篇 | 02-Thesis/Literature/ |
| 日记文件 | 待统计 | 01-Daily/ |

---

## 二、验证1：空间释放验证

### 检查命令（Windows Git Bash）

```bash
# 操作前统计（基线）
cd /e/000/knowledge
du -sh .

# 各模块大小统计
du -sh 00-Inbox/
du -sh 01-Daily/
du -sh 02-Thesis/
du -sh 03-Projects/
du -sh 04-Competitions/
du -sh 05-Tech/
du -sh 06-Growth/
du -sh 07-Resources/
du -sh Attachments/

# 操作后统计（对比）
du -sh .
```

### 预期释放空间

| 操作项 | 预计释放 |
|--------|----------|
| faceai-master2 删除 | 47M |
| 智慧城市材料去重 | ~100M（保留最新一届） |
| 违建数据集清理 | 待评估（123文件夹巨大） |
| 其他重复文件 | 待发现 |

### 回滚方案

```bash
# 如需要恢复，从 Quarantine 移回
mv Quarantine/faceai-master2 06-Growth/Courses/非学位课/智能计算/

# 或使用 git reflog 恢复（如已提交）
git reflog
git checkout <commit-hash> -- <file-path>
```

---

## 三、验证2：链接有效性验证

### 3.1 [[体重管理]] 链接验证

**问题发现**：文件实际名为 `体重管理管.md`（多了一个"管"字）

**检查命令**：
```bash
# 搜索所有引用该文件的地方
cd /e/000/knowledge
grep -r "\[\[体重管理\]\]" --include="*.md"
```

**修复方案**：
- 选项A：重命名文件为 `体重管理.md`
- 选项B：更新所有链接为 `[[体重管理管]]`

**回滚方案**：
```bash
# 如重命名文件，保留原始名称备份
cp 体重管理.md 体重管理.md.bak
# 或使用 git mv
git mv 体重管理管.md 体重管理.md
```

### 3.2 MOC-论文地图 文献链接验证

**创建后检查命令**：
```bash
# 读取MOC文件
cat "02-Thesis/MOC-论文地图.md"

# 验证每个链接的文件是否存在
grep -oP '\[\[([^\]]+)\]\]' "02-Thesis/MOC-论文地图.md" | while read link; do
  target=$(echo "$link" | sed 's/\[\[\(.*\)\]\]/\1/')
  find 02-Thesis -name "$target.md" -o -name "$target"
done
```

**预期结果**：
- 所有文献链接应指向实际存在的文件
- 链接格式：`[[论文标题]]` 或 `[[论文标题|别名]]`

### 3.3 死链检测（全局）

**检查命令**：
```bash
# 提取所有 [[链接]]
cd /e/000/knowledge
find . -name "*.md" -exec grep -oP '\[\[([^\]]+)\]\]' {} \; | sort | uniq > all_links.txt

# 生成所有实际文件名
find . -name "*.md" -type f | sed 's|.*/||' | sed 's|\.md$||' | sort > all_files.txt

# 找出死链（在链接中但不在文件中）
comm -23 all_links.txt all_files.txt > dead_links.txt
```

**回滚方案**：
- 保留修改前的所有链接引用
- 使用 `git diff` 查看具体修改内容

---

## 四、验证3：文件完整性验证

### 4.1 日记拆分完整性

**检查命令**：
```bash
# 操作前备份
tar -czf diary_backup_$(date +%Y%m%d).tar.gz 01-Daily/

# 拆分后验证
# 1. 检查文件总数是否增加（拆分会增加文件）
find 01-Daily/ -name "*.md" -type f | wc -l

# 2. 验证内容完整性（检查日期连续性）
ls -1 01-Daily/*.md | sort

# 3. 抽查内容对比（选取原始文件和新文件对比）
diff <(grep "2026-01-01" old_diary.md) <(grep "2026-01-01" new_diary.md)
```

**预期结果**：
- 原始内容应100%保留到新文件中
- 新文件应保持 Frontmatter 元数据
- 日期标签应正确迁移

### 4.2 重复删除完整性

**检查命令**：
```bash
# 对比保留的文件与被删除文件是否内容相同
diff faceai-master/README.md faceai-master2/README.md

# 验证保留版本是否完整
find faceai-master -type f -name "*.md" | wc -l
```

### 4.3 Quarantine 恢复测试

**检查命令**：
```bash
# 验证Quarantine目录结构
ls -R Quarantine/

# 恢复测试（选一个小文件）
cp Quarantine/test_file.md /tmp/
md5sum Quarantine/test_file.md /tmp/test_file.md
# 应输出相同MD5值
```

---

## 五、验证4：Frontmatter验证

### 5.1 MOC-论文地图 Frontmatter

**检查命令**：
```bash
# 读取文件前10行
head -n 10 "02-Thesis/MOC-论文地图.md"
```

**预期Frontmatter格式**：
```yaml
---
title: MOC-论文地图
date: 2026-02-07
tags:
  - MOC
  - 论文
  - 导航
category: 论文
---
```

### 5.2 使用心得.md Frontmatter

**检查命令**：
```bash
head -n 10 "05-Tech/Tools/Claude-Code/使用心得.md"
```

**问题发现**：当前文件只有1行，缺少Frontmatter

**补全方案**：
```yaml
---
title: Claude Code 使用心得
date: 2026-02-07
tags:
  - Claude-Code
  - 工具
  - 效率
category: 技术
updated: 2026-02-07
---
```

---

## 六、综合验证脚本

### 一键验证脚本

```bash
#!/bin/bash
# 知识库验证脚本

echo "=== 知识库验证报告 ===" > verification_report.txt
echo "验证时间: $(date)" >> verification_report.txt
echo "" >> verification_report.txt

# 1. 空间统计
echo "【1. 空间统计】" >> verification_report.txt
du -sh . >> verification_report.txt
du -sh */ >> verification_report.txt
echo "" >> verification_report.txt

# 2. 链接验证
echo "【2. 链接有效性】" >> verification_report.txt
grep -r "\[\[体重管理\]\]" --include="*.md" | wc -l >> verification_report.txt
echo "" >> verification_report.txt

# 3. 文件完整性
echo "【3. 文件统计】" >> verification_report.txt
find . -name "*.md" -type f | wc -l >> verification_report.txt
echo "" >> verification_report.txt

# 4. Frontmatter检查
echo "【4. Frontmatter检查】" >> verification_report.txt
for file in 02-Thesis/MOC-*.md 05-Tech/Tools/Claude-Code/使用心得.md; do
  if [ -f "$file" ]; then
    echo "检查: $file" >> verification_report.txt
    head -n 1 "$file" | grep -q "^---" && echo "  ✓ 有Frontmatter" || echo "  ✗ 缺少Frontmatter"
  fi
done

cat verification_report.txt
```

---

## 七、失败回滚预案

### 7.1 Git 回滚

```bash
# 查看最近的提交
git log --oneline -10

# 回滚到操作前的提交
git reset --hard <commit-hash>

# 或保留更改作为新提交回滚
git revert <commit-hash>
```

### 7.2 文件级回滚

```bash
# 从Quarantine恢复
mv Quarantine/<dirname> <original-path>

# 从备份恢复
tar -xzf diary_backup_20260207.tar.gz
```

---

## 八、验收通过标准

| 验证项 | 通过标准 |
|--------|----------|
| 空间释放 | 释放空间 > 50MB |
| 链接有效 | [[体重管理]] 链接可访问 |
| 文件完整 | 无内容丢失，MD5校验通过 |
| Frontmatter | 新建文件包含标准Frontmatter |
| 死链修复 | 死链数量减少或为0 |

---

## 九、下一步行动

1. [ ] 执行操作前基线统计（记录到本文件）
2. [ ] 执行清理操作
3. [ ] 运行验证脚本
4. [ ] 生成验证报告
5. [ ] 确认通过或回滚

---

**附件**：
- 知识库结构图
- 链接关系图
- 文件清单（待生成）
